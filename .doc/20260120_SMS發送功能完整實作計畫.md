# SMS ç™¼é€åŠŸèƒ½å®Œæ•´å¯¦ä½œè¨ˆç•«

**å»ºç«‹æ—¥æœŸ**: 2026-01-20
**å°ˆæ¡ˆ**: Sales AI Automation v3 - SMS å®¢æˆ¶é€šçŸ¥ç³»çµ±
**ç‹€æ…‹**: å¾…åŸ·è¡Œ

---

## ğŸ“‹ ç›®éŒ„

1. [éœ€æ±‚ç¸½è¦½](#éœ€æ±‚ç¸½è¦½)
2. [æŠ€è¡“æ¶æ§‹è¨­è¨ˆ](#æŠ€è¡“æ¶æ§‹è¨­è¨ˆ)
3. [éšæ®µä¸€ï¼šSlack Bot è¡¨å–®æ–°å¢é›»è©±æ¬„ä½](#éšæ®µä¸€slack-bot-è¡¨å–®æ–°å¢é›»è©±æ¬„ä½)
4. [éšæ®µäºŒï¼šå…¬é–‹åˆ†äº«é€£çµç³»çµ±](#éšæ®µäºŒå…¬é–‹åˆ†äº«é€£çµç³»çµ±)
5. [éšæ®µä¸‰ï¼šSMS ç™¼é€æœå‹™æ•´åˆ](#éšæ®µä¸‰sms-ç™¼é€æœå‹™æ•´åˆ)
6. [éšæ®µå››ï¼šSlack äº’å‹•æŒ‰éˆ•èˆ‡æµç¨‹](#éšæ®µå››slack-äº’å‹•æŒ‰éˆ•èˆ‡æµç¨‹)
7. [æ¸¬è©¦é©—æ”¶æ¨™æº–](#æ¸¬è©¦é©—æ”¶æ¨™æº–)
8. [éƒ¨ç½²æª¢æŸ¥æ¸…å–®](#éƒ¨ç½²æª¢æŸ¥æ¸…å–®)

---

## éœ€æ±‚ç¸½è¦½

### ä½¿ç”¨è€…æ•…äº‹

> **ä½œç‚ºæ¥­å‹™äººå“¡**ï¼Œæˆ‘å¸Œæœ›åœ¨çœ‹å®Œ MEDDIC åˆ†æ summary å¾Œï¼Œèƒ½å¤ **æ‰‹å‹•è§¸ç™¼**ç™¼é€ SMS çµ¦å®¢æˆ¶ï¼Œè®“å®¢æˆ¶é€é**å…¬é–‹é€£çµ**ï¼ˆä¸éœ€ç™»å…¥ï¼‰æŸ¥çœ‹åˆ†æçµæœï¼Œä»¥ä¾¿å®¢æˆ¶èƒ½å¿«é€Ÿäº†è§£æˆ‘å€‘çš„å°ˆæ¥­åˆ†æã€‚

### æ ¸å¿ƒéœ€æ±‚

1. âœ… **Slack Bot è¡¨å–®æ”¶é›†é›»è©±**
   - åœ¨ä¸Šå‚³éŸ³æª”æ™‚ï¼Œæ”¶é›†ã€Œå®¢æˆ¶é›»è©±ï¼ˆé¸å¡«ï¼‰ã€
   - é©—è­‰å°ç£æ‰‹æ©Ÿè™Ÿç¢¼æ ¼å¼ï¼ˆ`09\d{8}` æˆ– `0912-345-678`ï¼‰

2. âœ… **å…¬é–‹åˆ†äº«é€£çµ**
   - å®¢æˆ¶**ä¸éœ€ç™»å…¥**å°±èƒ½æŸ¥çœ‹ MEDDIC åˆ†æ
   - ä½¿ç”¨åŠ å¯† token ç¢ºä¿å®‰å…¨æ€§
   - è¨­å®šæœ‰æ•ˆæœŸé™ï¼ˆ7 å¤©ï¼‰

3. âœ… **æ¥­å‹™æ‰‹å‹•è§¸ç™¼ SMS**
   - åœ¨ Slack é€šçŸ¥ä¸­é¡¯ç¤ºã€Œç™¼é€ SMSã€æŒ‰éˆ•
   - é»æ“Šå¾Œç™¼é€ç²¾ç°¡ç‰ˆ SMS çµ¦å®¢æˆ¶
   - è¨˜éŒ„ç™¼é€æ™‚é–“ã€æˆåŠŸèˆ‡å¦

4. âœ… **ç²¾ç°¡ç‰ˆ SMS å…§å®¹**
   - å¼•å°å®¢æˆ¶é»æ“Šå…¬é–‹é€£çµæŸ¥çœ‹å®Œæ•´å ±å‘Š
   - ç´„ 70 å­—å…§ï¼ˆ1 å‰‡ç°¡è¨Šï¼‰

---

## æŠ€è¡“æ¶æ§‹è¨­è¨ˆ

### æ•´é«”æµç¨‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æ¥­å‹™åœ¨ Slack ä¸Šå‚³éŸ³æª”                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Slack Bot é¡¯ç¤ºè¡¨å–®                                             â”‚
â”‚    â”œâ”€ å®¢æˆ¶ç·¨è™Ÿï¼ˆå¿…å¡«ï¼‰                                            â”‚
â”‚    â”œâ”€ å®¢æˆ¶åç¨±ï¼ˆå¿…å¡«ï¼‰                                            â”‚
â”‚    â”œâ”€ å®¢æˆ¶é›»è©±ï¼ˆé¸å¡«ï¼Œå°ç£æ‰‹æ©Ÿæ ¼å¼é©—è­‰ï¼‰                           â”‚
â”‚    â””â”€ å…¶ä»–æ¬„ä½...                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. å»ºç«‹ Opportunity + Conversation                               â”‚
â”‚    â””â”€ contactPhone å„²å­˜åˆ°è³‡æ–™åº«                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Queue Worker è™•ç†éŸ³æª” â†’ MEDDIC åˆ†æ                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ç”Ÿæˆå…¬é–‹åˆ†äº« Token                                             â”‚
â”‚    â””â”€ åŠ å¯†: conversationId + expiry (7å¤©)                        â”‚
â”‚    â””â”€ å„²å­˜åˆ° share_tokens è¡¨æ ¼                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. ç™¼é€ Slack å®Œæˆé€šçŸ¥                                            â”‚
â”‚    â”œâ”€ é¡¯ç¤º MEDDIC summary                                        â”‚
â”‚    â”œâ”€ ã€ŒæŸ¥çœ‹å®Œæ•´åˆ†æã€æŒ‰éˆ•ï¼ˆæ¥­å‹™å°ˆç”¨ï¼Œéœ€ç™»å…¥ï¼‰                     â”‚
â”‚    â””â”€ ã€Œç™¼é€ SMS çµ¦å®¢æˆ¶ã€æŒ‰éˆ•ï¼ˆå¦‚æœæœ‰é›»è©±ï¼‰                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. æ¥­å‹™é»æ“Šã€Œç™¼é€ SMSã€æŒ‰éˆ•                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. ç¢ºèªå°è©±æ¡†                                                     â”‚
â”‚    â”œâ”€ é¡¯ç¤ºå®¢æˆ¶é›»è©±                                               â”‚
â”‚    â”œâ”€ é è¦½ SMS å…§å®¹                                              â”‚
â”‚    â””â”€ ç¢ºèª / å–æ¶ˆ                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ ç¢ºèª
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. èª¿ç”¨ EVERY8D API ç™¼é€ SMS                                     â”‚
â”‚    â””â”€ SMS å…§å®¹åŒ…å«å…¬é–‹åˆ†äº«é€£çµ                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10. è¨˜éŒ„ç™¼é€çµæœ                                                  â”‚
â”‚     â”œâ”€ å¯«å…¥ sms_logs è¡¨æ ¼                                        â”‚
â”‚     â”œâ”€ ç™¼é€æ™‚é–“                                                  â”‚
â”‚     â”œâ”€ æˆåŠŸ/å¤±æ•—ç‹€æ…‹                                             â”‚
â”‚     â””â”€ EVERY8D å›æ‡‰è³‡è¨Š                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 11. Slack é¡¯ç¤ºç™¼é€çµæœ                                            â”‚
â”‚     â”œâ”€ âœ… æˆåŠŸ: "ç°¡è¨Šå·²ç™¼é€è‡³ 0912-345-678"                       â”‚
â”‚     â””â”€ âŒ å¤±æ•—: "ç™¼é€å¤±æ•—: {éŒ¯èª¤åŸå› }"                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 12. å®¢æˆ¶æ”¶åˆ° SMS                                                  â”‚
â”‚     â””â”€ é»æ“Šé€£çµ â†’ å…¬é–‹ç¶²é ï¼ˆä¸éœ€ç™»å…¥ï¼‰                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## éšæ®µä¸€ï¼šSlack Bot è¡¨å–®æ–°å¢é›»è©±æ¬„ä½

### ç›®æ¨™
åœ¨ Slack Bot ä¸Šå‚³éŸ³æª”è¡¨å–®ä¸­æ–°å¢ã€Œå®¢æˆ¶é›»è©±ã€æ¬„ä½ï¼Œä¸¦é©—è­‰å°ç£æ‰‹æ©Ÿè™Ÿç¢¼æ ¼å¼ã€‚

### å¯¦ä½œæª”æ¡ˆ

#### 1. ä¿®æ”¹è¡¨å–®å»ºæ§‹å™¨

**æª”æ¡ˆ**: `apps/slack-bot/src/utils/form-builder.ts`

**è®Šæ›´ 1: æ–°å¢é›»è©±è™Ÿç¢¼é©—è­‰å‡½æ•¸**

åœ¨æª”æ¡ˆé–‹é ­æ–°å¢:
```typescript
/**
 * é©—è­‰å°ç£æ‰‹æ©Ÿè™Ÿç¢¼æ ¼å¼
 * æ”¯æ´æ ¼å¼:
 * - 0912345678
 * - 0912-345-678
 * - 09-1234-5678
 */
function validateTaiwanPhoneNumber(phone: string): boolean {
  if (!phone) return true; // é¸å¡«æ¬„ä½ï¼Œç©ºå€¼è¦–ç‚ºæœ‰æ•ˆ

  // ç§»é™¤æ‰€æœ‰éæ•¸å­—å­—å…ƒ
  const digitsOnly = phone.replace(/\D/g, '');

  // æª¢æŸ¥æ˜¯å¦ç‚º 10 ç¢¼ä¸”ä»¥ 09 é–‹é ­
  const isValid = /^09\d{8}$/.test(digitsOnly);

  return isValid;
}

/**
 * æ ¼å¼åŒ–å°ç£æ‰‹æ©Ÿè™Ÿç¢¼ç‚ºæ¨™æº–æ ¼å¼
 * è¼¸å…¥: "0912345678" æˆ– "0912-345-678"
 * è¼¸å‡º: "0912-345-678"
 */
function formatTaiwanPhoneNumber(phone: string): string {
  if (!phone) return '';

  const digitsOnly = phone.replace(/\D/g, '');

  if (digitsOnly.length === 10 && digitsOnly.startsWith('09')) {
    return `${digitsOnly.slice(0, 4)}-${digitsOnly.slice(4, 7)}-${digitsOnly.slice(7)}`;
  }

  return phone; // ç„¡æ³•æ ¼å¼åŒ–å‰‡è¿”å›åŸå€¼
}
```

**è®Šæ›´ 2: ä¿®æ”¹è¡¨å–®æ¬„ä½**

æ‰¾åˆ° `buildAudioUploadModal` å‡½æ•¸ï¼ˆç´„ Line 116ï¼‰ï¼Œä¿®æ”¹ `commonBlocks`:

```typescript
const commonBlocks = [
  buildTextInput("customer_number", "å®¢æˆ¶ç·¨è™Ÿ", "ä¾‹å¦‚ï¼šC001ã€A0123", true),
  buildTextInput("customer_name", "å®¢æˆ¶åç¨±", "ä¾‹å¦‚ï¼šç‹å°æ˜å’–å•¡åº—", true),
  buildTextInput(
    "contact_phone",
    "å®¢æˆ¶é›»è©±ï¼ˆé¸å¡«ï¼Œç”¨æ–¼ç™¼é€ SMS é€šçŸ¥ï¼‰",
    "ä¾‹å¦‚ï¼š0912-345-678",
    false // é¸å¡«
  ),
];
```

**è®Šæ›´ 3: æ›´æ–° Metadata é¡å‹**

æ‰¾åˆ° `AudioUploadMetadata` ä»‹é¢ï¼ˆç´„ Line 33ï¼‰ï¼Œæ–°å¢ `contactPhone`:

```typescript
export interface AudioUploadMetadata {
  customerNumber: string;
  customerName: string;
  contactPhone?: string; // æ–°å¢
  productLine?: ProductLine;
  storeType?: string;
  serviceType?: string;
  staffCount?: string;
  currentSystem?: string;
  decisionMakerPresent?: string;
}
```

**è®Šæ›´ 4: æ›´æ–°è¡¨å–®è§£æå™¨**

æ‰¾åˆ° `parseAudioUploadFormValues` å‡½æ•¸ï¼ˆç´„ Line 237ï¼‰ï¼Œæ–°å¢ `contactPhone` è§£æ:

```typescript
export function parseAudioUploadFormValues(
  values: Record<
    string,
    Record<string, { value?: string; selected_option?: { value: string } }>
  >,
  productLine: ProductLine
): Partial<AudioUploadMetadata> {
  // å–å¾—é›»è©±è™Ÿç¢¼åŸå§‹å€¼
  const rawPhone = values.contact_phone?.contact_phone?.value;

  // é©—è­‰ä¸¦æ ¼å¼åŒ–é›»è©±è™Ÿç¢¼
  let contactPhone: string | undefined;
  if (rawPhone) {
    if (validateTaiwanPhoneNumber(rawPhone)) {
      contactPhone = formatTaiwanPhoneNumber(rawPhone);
    } else {
      // æ ¼å¼ä¸æ­£ç¢ºï¼Œå¿½ç•¥æ­¤æ¬„ä½
      console.warn(`[Form] Invalid phone number: ${rawPhone}`);
      contactPhone = undefined;
    }
  }

  const metadata: Partial<AudioUploadMetadata> = {
    productLine,
    customerNumber: values.customer_number?.customer_number?.value,
    customerName: values.customer_name?.customer_name?.value,
    contactPhone, // æ–°å¢
    storeType: values.store_type?.store_type?.selected_option?.value,
    currentSystem: values.current_system?.current_system?.selected_option?.value,
    decisionMakerPresent: values.decision_maker_present?.decision_maker_present?.selected_option?.value,
  };

  // iCHEF ç‰¹å®šæ¬„ä½
  if (productLine === "ichef") {
    metadata.serviceType = values.service_type?.service_type?.selected_option?.value;
  }

  // Beauty ç‰¹å®šæ¬„ä½
  if (productLine === "beauty") {
    metadata.staffCount = values.staff_count?.staff_count?.selected_option?.value;
  }

  return metadata;
}
```

#### 2. ç¢ºèªäº‹ä»¶è™•ç†å™¨å‚³éé›»è©±

**æª”æ¡ˆ**: `apps/slack-bot/src/events/file.ts`

**æª¢æŸ¥é»**: ç¢ºèªåœ¨å»ºç«‹ opportunity æ™‚åŒ…å« `contactPhone`

æ‰¾åˆ° `apiClient.createOpportunity` èª¿ç”¨ï¼ˆç´„ Line 400+ï¼‰ï¼Œç¢ºèª:

```typescript
const opportunity = await apiClient.createOpportunity({
  customerNumber: metadata.customerNumber!,
  companyName: metadata.customerName!,
  contactPhone: metadata.contactPhone, // ç¢ºä¿é€™è¡Œå­˜åœ¨
  productLine: metadata.productLine,
  storeType: metadata.storeType,
  // ... å…¶ä»–æ¬„ä½
});
```

---

### æ¸¬è©¦é©—æ”¶

- [ ] Slack Bot ä¸Šå‚³éŸ³æª”æ™‚ï¼Œè¡¨å–®é¡¯ç¤ºã€Œå®¢æˆ¶é›»è©±ï¼ˆé¸å¡«ï¼Œç”¨æ–¼ç™¼é€ SMS é€šçŸ¥ï¼‰ã€æ¬„ä½
- [ ] å¡«å¯«æœ‰æ•ˆé›»è©±ï¼ˆä¾‹å¦‚ `0912345678`ï¼‰å¾Œæäº¤ï¼Œè³‡æ–™æ­£ç¢ºå„²å­˜ç‚º `0912-345-678`
- [ ] å¡«å¯«ç„¡æ•ˆé›»è©±ï¼ˆä¾‹å¦‚ `123`ï¼‰å¾Œæäº¤ï¼Œé›»è©±æ¬„ä½è¢«å¿½ç•¥ï¼ˆä¸å„²å­˜ï¼‰
- [ ] ä¸å¡«å¯«é›»è©±æ™‚ï¼Œå¯ä»¥æ­£å¸¸æäº¤
- [ ] è³‡æ–™åº« `opportunities.contactPhone` æ­£ç¢ºå„²å­˜

---

## éšæ®µäºŒï¼šå…¬é–‹åˆ†äº«é€£çµç³»çµ±

### ç›®æ¨™
å»ºç«‹ä¸€å€‹å…¬é–‹åˆ†äº«é€£çµç³»çµ±ï¼Œè®“å®¢æˆ¶ä¸éœ€ç™»å…¥å°±èƒ½æŸ¥çœ‹ MEDDIC åˆ†æçµæœã€‚

### è³‡æ–™åº« Schema

#### æ–°å¢ `share_tokens` è¡¨æ ¼

**æª”æ¡ˆ**: `packages/db/src/schema/share-token.ts`

```typescript
import { pgTable, text, timestamp, boolean } from "drizzle-orm/pg-core";
import { relations } from "drizzle-orm";
import { conversations } from "./conversation";

/**
 * å…¬é–‹åˆ†äº« Token è¡¨æ ¼
 * ç”¨æ–¼ç”Ÿæˆä¸éœ€ç™»å…¥å³å¯æŸ¥çœ‹çš„åˆ†äº«é€£çµ
 */
export const shareTokens = pgTable("share_tokens", {
  id: text("id").primaryKey(), // ä½¿ç”¨ nanoid ç”Ÿæˆï¼Œä¾‹å¦‚: "a1b2c3d4e5"

  // é—œè¯
  conversationId: text("conversation_id")
    .notNull()
    .references(() => conversations.id, { onDelete: "cascade" }),

  // Token è³‡è¨Š
  token: text("token").notNull().unique(), // åŠ å¯† tokenï¼Œç”¨æ–¼ URL

  // æœ‰æ•ˆæ€§
  expiresAt: timestamp("expires_at").notNull(), // éæœŸæ™‚é–“ï¼ˆ7å¤©ï¼‰
  isRevoked: boolean("is_revoked").default(false).notNull(), // æ˜¯å¦å·²æ’¤éŠ·

  // è¿½è¹¤è³‡è¨Š
  viewCount: text("view_count").default("0").notNull(), // æŸ¥çœ‹æ¬¡æ•¸ï¼ˆå­˜ç‚º string é¿å… bigint å•é¡Œï¼‰
  lastViewedAt: timestamp("last_viewed_at"), // æœ€å¾ŒæŸ¥çœ‹æ™‚é–“

  // æ™‚é–“æˆ³
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
});

// Relations
export const shareTokensRelations = relations(shareTokens, ({ one }) => ({
  conversation: one(conversations, {
    fields: [shareTokens.conversationId],
    references: [conversations.id],
  }),
}));

export type ShareToken = typeof shareTokens.$inferSelect;
export type NewShareToken = typeof shareTokens.$inferInsert;
```

**æª”æ¡ˆ**: `packages/db/src/schema/index.ts`

æ–°å¢ export:
```typescript
export * from "./share-token";
```

#### è³‡æ–™åº« Migration

**æª”æ¡ˆ**: å»ºç«‹æ–°çš„ migration æª”æ¡ˆ

```bash
cd packages/db
bun run drizzle-kit generate
```

ç”Ÿæˆçš„ SQL å¤§è‡´å¦‚ä¸‹:
```sql
CREATE TABLE "share_tokens" (
  "id" text PRIMARY KEY,
  "conversation_id" text NOT NULL REFERENCES "conversations"("id") ON DELETE CASCADE,
  "token" text NOT NULL UNIQUE,
  "expires_at" timestamp NOT NULL,
  "is_revoked" boolean DEFAULT false NOT NULL,
  "view_count" text DEFAULT '0' NOT NULL,
  "last_viewed_at" timestamp,
  "created_at" timestamp DEFAULT now() NOT NULL,
  "updated_at" timestamp DEFAULT now() NOT NULL
);

CREATE INDEX "share_tokens_conversation_id_idx" ON "share_tokens"("conversation_id");
CREATE INDEX "share_tokens_token_idx" ON "share_tokens"("token");
```

åŸ·è¡Œ migration:
```bash
bun run drizzle-kit push
```

---

### Token ç”Ÿæˆæœå‹™

**æª”æ¡ˆ**: `packages/services/src/share/token-generator.ts`

```typescript
import { customAlphabet } from "nanoid";
import { createHash, createHmac } from "crypto";

/**
 * ç”Ÿæˆ URL-safe çš„éš¨æ©Ÿ ID
 * ä½¿ç”¨ nanoidï¼Œä¸å«æ˜“æ··æ·†å­—å…ƒ (0OIl)
 */
const nanoid = customAlphabet(
  "123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",
  16
);

/**
 * ç”Ÿæˆå…¬é–‹åˆ†äº« Token
 *
 * @param conversationId - Conversation ID
 * @param secret - åŠ å¯†å¯†é‘°ï¼ˆå¾ç’°å¢ƒè®Šæ•¸å–å¾—ï¼‰
 * @returns åŠ å¯†çš„ token å­—ä¸²
 */
export function generateShareToken(
  conversationId: string,
  secret: string
): string {
  const randomPart = nanoid(); // 16 å­—å…ƒéš¨æ©Ÿå­—ä¸²
  const timestamp = Date.now().toString(36); // æ™‚é–“æˆ³è½‰ base36

  // çµ„åˆåŸå§‹è³‡æ–™
  const rawData = `${conversationId}:${timestamp}:${randomPart}`;

  // ä½¿ç”¨ HMAC-SHA256 ç°½å
  const signature = createHmac("sha256", secret)
    .update(rawData)
    .digest("base64url")
    .slice(0, 12); // å–å‰ 12 å­—å…ƒ

  // æœ€çµ‚ token: {randomPart}-{timestamp}-{signature}
  return `${randomPart}-${timestamp}-${signature}`;
}

/**
 * é©—è­‰ä¸¦è§£æ Token
 *
 * @param token - Token å­—ä¸²
 * @param secret - åŠ å¯†å¯†é‘°
 * @returns å¦‚æœæœ‰æ•ˆè¿”å› { conversationId, timestamp }, å¦å‰‡è¿”å› null
 */
export function verifyShareToken(
  token: string,
  secret: string
): { conversationId: string; timestamp: number } | null {
  try {
    const parts = token.split("-");
    if (parts.length !== 3) return null;

    const [randomPart, timestamp, signature] = parts;

    // éœ€è¦å¾è³‡æ–™åº«æŸ¥è©¢ conversationId
    // é€™å€‹å‡½æ•¸åªé©—è­‰ token æ ¼å¼ï¼Œå¯¦éš›é©—è­‰åœ¨ API å±¤é€²è¡Œ

    return {
      conversationId: "", // éœ€è¦å¾ DB æŸ¥è©¢
      timestamp: parseInt(timestamp, 36),
    };
  } catch {
    return null;
  }
}

/**
 * è¨ˆç®— Token éæœŸæ™‚é–“
 *
 * @param days - æœ‰æ•ˆå¤©æ•¸ï¼ˆé è¨­ 7 å¤©ï¼‰
 * @returns Date ç‰©ä»¶
 */
export function getTokenExpiry(days = 7): Date {
  const expiry = new Date();
  expiry.setDate(expiry.getDate() + days);
  return expiry;
}
```

---

### API ç«¯é»

**æª”æ¡ˆ**: `packages/api/src/routers/share.ts`

```typescript
import { ORPCError } from "@orpc/server";
import { and, eq } from "drizzle-orm";
import { z } from "zod";
import { db } from "@Sales_ai_automation_v3/db";
import { shareTokens, conversations, opportunities, meddicAnalyses } from "@Sales_ai_automation_v3/db/schema";
import { publicProcedure } from "../procedures";
import { generateShareToken, getTokenExpiry } from "@Sales_ai_automation_v3/services/share/token-generator";
import { nanoid } from "nanoid";

/**
 * ç”Ÿæˆå…¬é–‹åˆ†äº« Token (å…§éƒ¨ä½¿ç”¨)
 */
export const createShareToken = publicProcedure
  .input(
    z.object({
      conversationId: z.string(),
    })
  )
  .handler(async ({ input, context }) => {
    const { conversationId } = input;

    // æª¢æŸ¥ conversation æ˜¯å¦å­˜åœ¨
    const conversation = await db.query.conversations.findFirst({
      where: eq(conversations.id, conversationId),
    });

    if (!conversation) {
      throw new ORPCError("NOT_FOUND", "Conversation not found");
    }

    // æª¢æŸ¥æ˜¯å¦å·²æœ‰æœ‰æ•ˆçš„ token
    const existingToken = await db.query.shareTokens.findFirst({
      where: and(
        eq(shareTokens.conversationId, conversationId),
        eq(shareTokens.isRevoked, false)
      ),
    });

    if (existingToken && new Date(existingToken.expiresAt) > new Date()) {
      // è¿”å›ç¾æœ‰ token
      return {
        token: existingToken.token,
        expiresAt: existingToken.expiresAt,
      };
    }

    // ç”Ÿæˆæ–° token
    const secret = context.env.SHARE_TOKEN_SECRET || "default-secret"; // å¾ç’°å¢ƒè®Šæ•¸å–å¾—
    const token = generateShareToken(conversationId, secret);
    const expiresAt = getTokenExpiry(7); // 7 å¤©æœ‰æ•ˆ

    // å„²å­˜åˆ°è³‡æ–™åº«
    const [newToken] = await db
      .insert(shareTokens)
      .values({
        id: nanoid(),
        conversationId,
        token,
        expiresAt,
        isRevoked: false,
        viewCount: "0",
      })
      .returning();

    return {
      token: newToken.token,
      expiresAt: newToken.expiresAt,
    };
  });

/**
 * é€é Token å–å¾— Conversation è©³æƒ…ï¼ˆå…¬é–‹ APIï¼Œä¸éœ€ç™»å…¥ï¼‰
 */
export const getConversationByToken = publicProcedure
  .input(
    z.object({
      token: z.string(),
    })
  )
  .handler(async ({ input }) => {
    const { token } = input;

    // æŸ¥è©¢ token
    const shareToken = await db.query.shareTokens.findFirst({
      where: eq(shareTokens.token, token),
    });

    if (!shareToken) {
      throw new ORPCError("NOT_FOUND", "Invalid or expired share link");
    }

    // æª¢æŸ¥æ˜¯å¦éæœŸ
    if (new Date(shareToken.expiresAt) < new Date()) {
      throw new ORPCError("FORBIDDEN", "Share link has expired");
    }

    // æª¢æŸ¥æ˜¯å¦è¢«æ’¤éŠ·
    if (shareToken.isRevoked) {
      throw new ORPCError("FORBIDDEN", "Share link has been revoked");
    }

    // æ›´æ–°æŸ¥çœ‹æ¬¡æ•¸å’Œæœ€å¾ŒæŸ¥çœ‹æ™‚é–“
    await db
      .update(shareTokens)
      .set({
        viewCount: String(Number(shareToken.viewCount) + 1),
        lastViewedAt: new Date(),
        updatedAt: new Date(),
      })
      .where(eq(shareTokens.id, shareToken.id));

    // æŸ¥è©¢å®Œæ•´çš„ conversation è³‡æ–™
    const conversation = await db.query.conversations.findFirst({
      where: eq(conversations.id, shareToken.conversationId),
      with: {
        opportunity: true,
        meddicAnalysis: true,
      },
    });

    if (!conversation) {
      throw new ORPCError("NOT_FOUND", "Conversation not found");
    }

    // è¿”å›å…¬é–‹å¯è¦‹çš„è³‡æ–™ï¼ˆç§»é™¤æ•æ„Ÿè³‡è¨Šï¼‰
    return {
      id: conversation.id,
      caseNumber: conversation.caseNumber,
      status: conversation.status,
      companyName: conversation.opportunity?.companyName || "",
      conversationDate: conversation.conversationDate,
      duration: conversation.duration,
      transcript: conversation.transcript,
      meddicAnalysis: conversation.meddicAnalysis
        ? {
            overallScore: conversation.meddicAnalysis.overallScore,
            status: conversation.meddicAnalysis.status,
            dimensions: conversation.meddicAnalysis.dimensions,
            keyFindings: conversation.meddicAnalysis.keyFindings,
            nextSteps: conversation.meddicAnalysis.nextSteps,
            risks: conversation.meddicAnalysis.risks,
          }
        : null,
      createdAt: conversation.createdAt,
    };
  });
```

**æª”æ¡ˆ**: `packages/api/src/routers/index.ts`

æ–°å¢ share router:
```typescript
import { share } from "./share";

export const router = {
  // ... å…¶ä»– routers
  share: {
    create: share.createShareToken,
    get: share.getConversationByToken,
  },
};
```

---

### å‰ç«¯å…¬é–‹åˆ†äº«é é¢

**æª”æ¡ˆ**: `apps/web/src/routes/share/$token.tsx`

```typescript
import { useQuery } from "@tanstack/react-query";
import { createFileRoute } from "@tanstack/react-router";
import { Badge } from "@/components/ui/badge";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Skeleton } from "@/components/ui/skeleton";
import { client } from "@/utils/orpc";
import { AlertCircle, CheckCircle2, Clock, XCircle } from "lucide-react";

export const Route = createFileRoute("/share/$token")({
  component: PublicSharePage,
});

function PublicSharePage() {
  const { token } = Route.useParams();

  const conversationQuery = useQuery({
    queryKey: ["share", "conversation", token],
    queryFn: async () => {
      return await client.share.get({ token });
    },
    retry: false, // Token ç„¡æ•ˆå°±ä¸é‡è©¦
  });

  const conversation = conversationQuery.data;
  const isLoading = conversationQuery.isLoading;
  const isError = conversationQuery.isError;

  if (isLoading) {
    return (
      <div className="container mx-auto max-w-4xl space-y-6 p-8">
        <Skeleton className="h-12 w-64" />
        <Skeleton className="h-96 w-full" />
      </div>
    );
  }

  if (isError) {
    return (
      <div className="container mx-auto max-w-4xl p-8">
        <Card className="border-red-200">
          <CardContent className="p-8 text-center">
            <XCircle className="mx-auto mb-4 h-16 w-16 text-red-500" />
            <h2 className="mb-2 font-bold text-2xl">é€£çµç„¡æ•ˆæˆ–å·²éæœŸ</h2>
            <p className="text-muted-foreground">
              {conversationQuery.error?.message || "æ­¤åˆ†äº«é€£çµä¸å­˜åœ¨æˆ–å·²å¤±æ•ˆï¼Œè«‹è¯ç¹«æ‚¨çš„æ¥­å‹™å°ˆå“¡ã€‚"}
            </p>
          </CardContent>
        </Card>
      </div>
    );
  }

  if (!conversation) {
    return null;
  }

  const meddicScore = conversation.meddicAnalysis?.overallScore || 0;
  const meddicStatus = conversation.meddicAnalysis?.status || "æœªçŸ¥";

  return (
    <div className="container mx-auto max-w-4xl space-y-6 p-8">
      {/* Header */}
      <div className="text-center">
        <h1 className="mb-2 font-bold text-3xl">
          {conversation.companyName} - éŠ·å”®å°è©±åˆ†æ
        </h1>
        <p className="text-muted-foreground">
          æ¡ˆä»¶ç·¨è™Ÿ: {conversation.caseNumber}
        </p>
      </div>

      {/* MEDDIC Score Card */}
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <CheckCircle2 className="h-5 w-5 text-green-500" />
            MEDDIC è³‡æ ¼è©•ä¼°
          </CardTitle>
        </CardHeader>
        <CardContent>
          <div className="flex items-center justify-between">
            <div>
              <p className="text-muted-foreground text-sm">ç¶œåˆè©•åˆ†</p>
              <p className="font-bold text-4xl">{meddicScore}/100</p>
            </div>
            <Badge
              className="text-lg"
              variant={
                meddicScore >= 70
                  ? "default"
                  : meddicScore >= 40
                    ? "secondary"
                    : "destructive"
              }
            >
              {meddicStatus}
            </Badge>
          </div>
        </CardContent>
      </Card>

      {/* MEDDIC Dimensions */}
      {conversation.meddicAnalysis?.dimensions && (
        <Card>
          <CardHeader>
            <CardTitle>MEDDIC å…­ç¶­åº¦åˆ†æ</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="space-y-4">
              {Object.entries(conversation.meddicAnalysis.dimensions).map(([key, dim]: [string, any]) => (
                <div key={key} className="space-y-1">
                  <div className="flex items-center justify-between">
                    <span className="font-medium text-sm">{key}</span>
                    <span className="text-muted-foreground text-sm">
                      {dim.score}/5
                    </span>
                  </div>
                  <div className="h-2 overflow-hidden rounded-full bg-muted">
                    <div
                      className={`h-full ${
                        dim.score >= 4
                          ? "bg-green-500"
                          : dim.score >= 3
                            ? "bg-yellow-500"
                            : "bg-red-500"
                      }`}
                      style={{ width: `${(dim.score / 5) * 100}%` }}
                    />
                  </div>
                </div>
              ))}
            </div>
          </CardContent>
        </Card>
      )}

      {/* Next Steps */}
      {conversation.meddicAnalysis?.nextSteps && (
        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <Clock className="h-5 w-5" />
              ä¸‹ä¸€æ­¥è¡Œå‹•
            </CardTitle>
          </CardHeader>
          <CardContent>
            <ul className="space-y-2">
              {conversation.meddicAnalysis.nextSteps.map((step: any, i: number) => (
                <li className="flex items-start gap-2" key={i}>
                  <span className="text-muted-foreground">â€¢</span>
                  <span>{step.action || step}</span>
                </li>
              ))}
            </ul>
          </CardContent>
        </Card>
      )}

      {/* Risks */}
      {conversation.meddicAnalysis?.risks && conversation.meddicAnalysis.risks.length > 0 && (
        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2 text-orange-600">
              <AlertCircle className="h-5 w-5" />
              é¢¨éšªæé†’
            </CardTitle>
          </CardHeader>
          <CardContent>
            <ul className="space-y-2">
              {conversation.meddicAnalysis.risks.map((risk: any, i: number) => (
                <li className="flex items-start gap-2" key={i}>
                  <span className="text-orange-600">âš ï¸</span>
                  <span>{risk.risk || risk}</span>
                </li>
              ))}
            </ul>
          </CardContent>
        </Card>
      )}

      {/* Footer */}
      <div className="text-center text-muted-foreground text-sm">
        <p>æ­¤å ±å‘Šç”± iCHEF Sales AI ç³»çµ±è‡ªå‹•ç”Ÿæˆ</p>
        <p>å¦‚æœ‰ç–‘å•ï¼Œè«‹è¯ç¹«æ‚¨çš„æ¥­å‹™å°ˆå“¡</p>
      </div>
    </div>
  );
}
```

---

### æ¸¬è©¦é©—æ”¶

- [ ] Queue Worker è™•ç†å®Œæˆå¾Œï¼ŒæˆåŠŸç”Ÿæˆ share token
- [ ] Token å„²å­˜åˆ° `share_tokens` è¡¨æ ¼
- [ ] è¨ªå• `/share/{token}` å¯ä»¥çœ‹åˆ° MEDDIC åˆ†æï¼ˆä¸éœ€ç™»å…¥ï¼‰
- [ ] è¨ªå•ç„¡æ•ˆ token é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
- [ ] è¨ªå•éæœŸ token é¡¯ç¤ºéæœŸè¨Šæ¯
- [ ] æŸ¥çœ‹æ¬¡æ•¸å’Œæœ€å¾ŒæŸ¥çœ‹æ™‚é–“æ­£ç¢ºè¨˜éŒ„

---

## éšæ®µä¸‰ï¼šSMS ç™¼é€æœå‹™æ•´åˆ

### ç›®æ¨™
æ•´åˆ EVERY8D SMS æœå‹™ï¼Œæ”¯æ´ç™¼é€ç°¡è¨Šçµ¦å®¢æˆ¶ã€‚

### EVERY8D API æ•´åˆ

**æª”æ¡ˆ**: `packages/services/src/sms/every8d.ts`

```typescript
/**
 * EVERY8D SMS æœå‹™æ•´åˆ
 * API æ–‡ä»¶: https://www.every8d.com/api
 */

export interface SendSMSParams {
  phoneNumber: string; // æ”¶ä»¶äººé›»è©±è™Ÿç¢¼
  message: string; // ç°¡è¨Šå…§å®¹
  subject?: string; // ç°¡è¨Šä¸»æ—¨ï¼ˆé¸å¡«ï¼‰
}

export interface SendSMSResponse {
  success: boolean;
  statusCode: string;
  statusMessage: string;
  credit: number; // ç™¼é€æˆæœ¬
  creditAfter: number; // å‰©é¤˜é»æ•¸
  messageId?: string; // è¨Šæ¯ ID
  errorDetails?: string;
}

/**
 * ç™¼é€ SMS
 */
export async function sendSMS(
  params: SendSMSParams,
  config: {
    apiUrl: string;
    username: string;
    password: string;
  }
): Promise<SendSMSResponse> {
  const { phoneNumber, message, subject } = params;
  const { apiUrl, username, password } = config;

  try {
    // å»ºç«‹ EVERY8D API è«‹æ±‚
    const response = await fetch(apiUrl, {
      method: "POST",
      headers: {
        "Content-Type": "application/x-www-form-urlencoded",
      },
      body: new URLSearchParams({
        UID: username,
        PWD: password,
        SB: subject || "iCHEF",
        MSG: message,
        DEST: phoneNumber,
        ST: "", // é ç´„æ™‚é–“ï¼ˆç©ºå€¼è¡¨ç¤ºç«‹å³ç™¼é€ï¼‰
      }),
    });

    const result = await response.text();

    // è§£æ EVERY8D å›æ‡‰
    // æ ¼å¼: "credit,sended,cost,unsend,batch_id"
    // ç¯„ä¾‹: "99.5,1,0.5,0,1234567890"
    const parts = result.split(",");

    if (parts.length >= 5) {
      const [creditAfter, sended, cost, unsend, batchId] = parts;

      return {
        success: Number(sended) > 0,
        statusCode: Number(sended) > 0 ? "SUCCESS" : "FAILED",
        statusMessage: Number(sended) > 0 ? "ç™¼é€æˆåŠŸ" : "ç™¼é€å¤±æ•—",
        credit: Number(cost),
        creditAfter: Number(creditAfter),
        messageId: batchId,
      };
    }

    // éŒ¯èª¤æ ¼å¼
    return {
      success: false,
      statusCode: "ERROR",
      statusMessage: "EVERY8D API å›æ‡‰æ ¼å¼éŒ¯èª¤",
      credit: 0,
      creditAfter: 0,
      errorDetails: result,
    };
  } catch (error) {
    return {
      success: false,
      statusCode: "NETWORK_ERROR",
      statusMessage: "ç¶²è·¯éŒ¯èª¤",
      credit: 0,
      creditAfter: 0,
      errorDetails: String(error),
    };
  }
}

/**
 * ç”Ÿæˆå®¢æˆ¶ SMS å…§å®¹
 */
export function generateCustomerSMSContent(data: {
  companyName: string;
  caseNumber: string;
  meddicScore: number;
  shareUrl: string;
}): string {
  const { companyName, caseNumber, meddicScore, shareUrl } = data;

  return `ã€iCHEFã€‘${companyName} æ‚¨å¥½ï¼Œæ‚¨çš„éŠ·å”®å°è©±åˆ†æå·²å®Œæˆï¼

æ¡ˆä»¶ç·¨è™Ÿ: ${caseNumber}
MEDDIC åˆ†æ•¸: ${meddicScore}/100

æŸ¥çœ‹å®Œæ•´å ±å‘Š:
${shareUrl}

å¦‚æœ‰ç–‘å•è«‹è¯ç¹«æ‚¨çš„æ¥­å‹™å°ˆå“¡ã€‚`;
}
```

---

### API ç«¯é»

**æª”æ¡ˆ**: `packages/api/src/routers/sms.ts`

```typescript
import { ORPCError } from "@orpc/server";
import { eq } from "drizzle-orm";
import { z } from "zod";
import { db } from "@Sales_ai_automation_v3/db";
import { conversations, smsLogs } from "@Sales_ai_automation_v3/db/schema";
import { protectedProcedure } from "../procedures";
import { sendSMS, generateCustomerSMSContent } from "@Sales_ai_automation_v3/services/sms/every8d";
import { nanoid } from "nanoid";

/**
 * ç™¼é€å®¢æˆ¶ SMS
 */
export const sendCustomerSMS = protectedProcedure
  .input(
    z.object({
      conversationId: z.string(),
    })
  )
  .handler(async ({ input, context }) => {
    const { conversationId } = input;
    const userId = context.session?.user.id;

    // æŸ¥è©¢ conversation å’Œç›¸é—œè³‡æ–™
    const conversation = await db.query.conversations.findFirst({
      where: eq(conversations.id, conversationId),
      with: {
        opportunity: true,
        meddicAnalysis: true,
      },
    });

    if (!conversation) {
      throw new ORPCError("NOT_FOUND", "Conversation not found");
    }

    // æª¢æŸ¥æ˜¯å¦æœ‰å®¢æˆ¶é›»è©±
    const phoneNumber = conversation.opportunity?.contactPhone;
    if (!phoneNumber) {
      throw new ORPCError("BAD_REQUEST", "å®¢æˆ¶é›»è©±è™Ÿç¢¼ä¸å­˜åœ¨");
    }

    // ç”Ÿæˆ share tokenï¼ˆå¦‚æœé‚„æ²’æœ‰ï¼‰
    const shareTokenResponse = await context.procedures.share.create({
      conversationId,
    });

    const shareUrl = `${context.env.WEB_APP_URL}/share/${shareTokenResponse.token}`;

    // ç”Ÿæˆ SMS å…§å®¹
    const smsContent = generateCustomerSMSContent({
      companyName: conversation.opportunity.companyName,
      caseNumber: conversation.caseNumber,
      meddicScore: conversation.meddicAnalysis?.overallScore || 0,
      shareUrl,
    });

    // ç™¼é€ SMS
    const smsResult = await sendSMS(
      {
        phoneNumber,
        message: smsContent,
        subject: "iCHEF",
      },
      {
        apiUrl: context.env.EVERY8D_API_URL,
        username: context.env.EVERY8D_USERNAME,
        password: context.env.EVERY8D_PASSWORD,
      }
    );

    // è¨˜éŒ„ç™¼é€çµæœåˆ° sms_logs
    await db.insert(smsLogs).values({
      id: nanoid(),
      userId,
      opportunityId: conversation.opportunityId,
      conversationId,
      phoneNumber,
      subject: "iCHEF",
      message: smsContent,
      batchId: smsResult.messageId,
      statusCode: smsResult.statusCode,
      statusMessage: smsResult.statusMessage,
      errorDetails: smsResult.errorDetails,
      cost: smsResult.credit,
      creditAfter: smsResult.creditAfter,
      deliveredAt: smsResult.success ? new Date() : null,
    });

    return {
      success: smsResult.success,
      message: smsResult.statusMessage,
      phoneNumber,
    };
  });
```

**æª”æ¡ˆ**: `packages/api/src/routers/index.ts`

æ–°å¢ SMS router:
```typescript
import { sms } from "./sms";

export const router = {
  // ... å…¶ä»– routers
  sms: {
    sendCustomer: sms.sendCustomerSMS,
  },
};
```

---

### ç’°å¢ƒè®Šæ•¸è¨­å®š

**æª”æ¡ˆ**: `apps/server/wrangler.toml`

æ–°å¢ç’°å¢ƒè®Šæ•¸ï¼ˆä½¿ç”¨ `wrangler secret put` è¨­å®šï¼‰:

```toml
# ä»¥ä¸‹è®Šæ•¸éœ€è¦ä½¿ç”¨ wrangler secret put å‘½ä»¤è¨­å®šï¼š
# - EVERY8D_API_URL (ä¾‹å¦‚: https://oms.every8d.com/API21/HTTP/sendSMS.ashx)
# - EVERY8D_USERNAME
# - EVERY8D_PASSWORD
# - SHARE_TOKEN_SECRET (ç”¨æ–¼åŠ å¯† share token)
# - WEB_APP_URL (å‰ç«¯ç¶²å€ï¼Œä¾‹å¦‚: https://sales-ai-web.pages.dev)
```

è¨­å®šæ–¹å¼:
```bash
cd apps/server
bun wrangler secret put EVERY8D_API_URL
bun wrangler secret put EVERY8D_USERNAME
bun wrangler secret put EVERY8D_PASSWORD
bun wrangler secret put SHARE_TOKEN_SECRET
bun wrangler secret put WEB_APP_URL
```

**æª”æ¡ˆ**: `apps/server/src/types.ts`

æ›´æ–°ç’°å¢ƒè®Šæ•¸é¡å‹:
```typescript
export interface Env {
  // ... ç¾æœ‰ç’°å¢ƒè®Šæ•¸

  // EVERY8D SMS
  EVERY8D_API_URL: string;
  EVERY8D_USERNAME: string;
  EVERY8D_PASSWORD: string;

  // Share Token
  SHARE_TOKEN_SECRET: string;
  WEB_APP_URL: string;
}
```

---

### æ¸¬è©¦é©—æ”¶

- [ ] å‘¼å« `sms.sendCustomer` API æˆåŠŸç™¼é€ SMS
- [ ] æ”¶åˆ°çš„ SMS å…§å®¹æ­£ç¢ºï¼ˆåŒ…å«åˆ†äº«é€£çµï¼‰
- [ ] ç™¼é€è¨˜éŒ„æ­£ç¢ºå¯«å…¥ `sms_logs` è¡¨æ ¼
- [ ] ç™¼é€æˆåŠŸæ™‚ï¼Œ`statusCode` ç‚º "SUCCESS"
- [ ] ç™¼é€å¤±æ•—æ™‚ï¼Œ`errorDetails` è¨˜éŒ„éŒ¯èª¤åŸå› 
- [ ] é»æ“Š SMS ä¸­çš„é€£çµï¼Œå¯ä»¥é–‹å•Ÿå…¬é–‹åˆ†äº«é é¢

---

## éšæ®µå››ï¼šSlack äº’å‹•æŒ‰éˆ•èˆ‡æµç¨‹

### ç›®æ¨™
åœ¨ Slack å®Œæˆé€šçŸ¥ä¸­æ–°å¢ã€Œç™¼é€ SMSã€æŒ‰éˆ•ï¼Œä¸¦è™•ç†äº’å‹•æµç¨‹ã€‚

### ä¿®æ”¹ Slack é€šçŸ¥ Blocks

**æª”æ¡ˆ**: `packages/services/src/notifications/blocks.ts`

æ‰¾åˆ° `buildProcessingCompletedBlocks` å‡½æ•¸ï¼Œä¿®æ”¹æŒ‰éˆ•å€å¡Š:

```typescript
export function buildProcessingCompletedBlocks(
  params: ProcessingCompletedParams
): KnownBlock[] {
  const {
    conversationId,
    caseNumber,
    analysisResult,
    processingTimeMs,
    contactPhone, // æ–°å¢åƒæ•¸
    shareToken, // æ–°å¢åƒæ•¸
  } = params;

  const blocks: KnownBlock[] = [
    // ... ç¾æœ‰ blocks (summary, score, etc.)
  ];

  // æ“ä½œæŒ‰éˆ•
  const actionButtons: any[] = [
    {
      type: "button",
      text: {
        type: "plain_text",
        text: "ğŸ“Š æŸ¥çœ‹å®Œæ•´åˆ†æ",
        emoji: true,
      },
      url: `${process.env.WEB_APP_URL}/conversations/${conversationId}`,
      style: "primary",
    },
  ];

  // å¦‚æœæœ‰å®¢æˆ¶é›»è©±ï¼Œæ–°å¢ã€Œç™¼é€ SMSã€æŒ‰éˆ•
  if (contactPhone) {
    actionButtons.push({
      type: "button",
      text: {
        type: "plain_text",
        text: "ğŸ“± ç™¼é€ SMS çµ¦å®¢æˆ¶",
        emoji: true,
      },
      action_id: "send_customer_sms",
      value: JSON.stringify({
        conversationId,
        phoneNumber: contactPhone,
        shareToken,
      }),
      style: "primary",
    });
  }

  blocks.push({
    type: "actions",
    elements: actionButtons,
  });

  return blocks;
}
```

**æª”æ¡ˆ**: `packages/services/src/notifications/types.ts`

æ›´æ–°é¡å‹å®šç¾©:
```typescript
export interface ProcessingCompletedParams {
  userId: string;
  conversationId: string;
  caseNumber: string;
  analysisResult: {
    overallScore: number;
    qualificationStatus: string;
    dimensions: Record<string, MEDDICDimension>;
    keyFindings: string[];
    nextSteps: Array<{
      action: string;
      priority: string;
      owner?: string;
    }>;
    risks: Array<{
      risk: string;
      severity: string;
      mitigation?: string;
    }>;
    alerts?: string[];
  };
  processingTimeMs: number;
  threadTs?: string;
  contactPhone?: string; // æ–°å¢
  shareToken?: string; // æ–°å¢
}
```

---

### ä¿®æ”¹ Queue Worker

**æª”æ¡ˆ**: `apps/queue-worker/src/index.ts`

åœ¨ Step 6 (ç™¼é€å®Œæˆé€šçŸ¥) å‰ï¼Œæ–°å¢ç”Ÿæˆ share token:

```typescript
// Step 5.5: ç”Ÿæˆå…¬é–‹åˆ†äº« Token
let shareToken: string | undefined;
try {
  // èª¿ç”¨ API ç”Ÿæˆ token
  const tokenResponse = await fetch(
    `${env.SERVER_URL}/rpc/share/create`,
    {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ conversationId }),
    }
  );

  if (tokenResponse.ok) {
    const tokenData = await tokenResponse.json();
    shareToken = tokenData.token;
    console.log(`[Queue] âœ… Share token generated: ${shareToken}`);
  }
} catch (error) {
  console.error("[Queue] âŒ Failed to generate share token:", error);
}

// Step 6: ç™¼é€å®Œæˆé€šçŸ¥
await slackService.notifyProcessingCompleted({
  userId: slackUser.id,
  conversationId,
  caseNumber,
  analysisResult: {
    overallScore,
    qualificationStatus,
    dimensions: convertedDimensions,
    keyFindings,
    nextSteps,
    risks,
    alerts,
  },
  processingTimeMs,
  threadTs,
  contactPhone: opportunity?.contactPhone, // æ–°å¢
  shareToken, // æ–°å¢
});
```

---

### Slack Bot äº’å‹•è™•ç†

**æª”æ¡ˆ**: `apps/slack-bot/src/index.ts`

æ–°å¢ `send_customer_sms` action è™•ç†å™¨:

```typescript
// è™•ç†ã€Œç™¼é€ SMSã€æŒ‰éˆ•é»æ“Š
app.action("send_customer_sms", async ({ ack, body, client }) => {
  await ack();

  try {
    const action = body.actions[0];
    if (action.type !== "button") return;

    const value = JSON.parse(action.value);
    const { conversationId, phoneNumber, shareToken } = value;

    // é¡¯ç¤ºç¢ºèªå°è©±æ¡†
    await client.views.open({
      trigger_id: body.trigger_id,
      view: {
        type: "modal",
        callback_id: "confirm_send_sms",
        title: {
          type: "plain_text",
          text: "ç¢ºèªç™¼é€ SMS",
        },
        submit: {
          type: "plain_text",
          text: "ç™¼é€",
        },
        close: {
          type: "plain_text",
          text: "å–æ¶ˆ",
        },
        blocks: [
          {
            type: "section",
            text: {
              type: "mrkdwn",
              text: `*å®¢æˆ¶é›»è©±*: ${phoneNumber}\n\nç¢ºå®šè¦ç™¼é€ SMS çµ¦å®¢æˆ¶å—ï¼Ÿ`,
            },
          },
          {
            type: "section",
            text: {
              type: "mrkdwn",
              text: "*SMS å…§å®¹é è¦½*:",
            },
          },
          {
            type: "section",
            text: {
              type: "mrkdwn",
              text: `\`\`\`ã€iCHEFã€‘æ‚¨å¥½ï¼Œæ‚¨çš„éŠ·å”®å°è©±åˆ†æå·²å®Œæˆï¼\n\næŸ¥çœ‹å®Œæ•´å ±å‘Š:\n${process.env.WEB_APP_URL}/share/${shareToken}\n\nå¦‚æœ‰ç–‘å•è«‹è¯ç¹«æ‚¨çš„æ¥­å‹™å°ˆå“¡ã€‚\`\`\``,
            },
          },
        ],
        private_metadata: JSON.stringify({
          conversationId,
          phoneNumber,
          shareToken,
        }),
      },
    });
  } catch (error) {
    console.error("Error handling send_customer_sms action:", error);
  }
});

// è™•ç†ç¢ºèªç™¼é€ SMS
app.view("confirm_send_sms", async ({ ack, body, view, client }) => {
  await ack();

  try {
    const metadata = JSON.parse(view.private_metadata);
    const { conversationId } = metadata;

    // èª¿ç”¨ API ç™¼é€ SMS
    const response = await fetch(`${process.env.SERVER_URL}/rpc/sms/sendCustomer`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ conversationId }),
    });

    const result = await response.json();

    // ç™¼é€çµæœé€šçŸ¥
    if (result.success) {
      await client.chat.postMessage({
        channel: body.user.id,
        text: `:white_check_mark: ç°¡è¨Šå·²æˆåŠŸç™¼é€è‡³ ${result.phoneNumber}`,
      });
    } else {
      await client.chat.postMessage({
        channel: body.user.id,
        text: `:x: ç°¡è¨Šç™¼é€å¤±æ•—: ${result.message}`,
      });
    }
  } catch (error) {
    console.error("Error sending SMS:", error);
    await client.chat.postMessage({
      channel: body.user.id,
      text: `:x: ç°¡è¨Šç™¼é€å¤±æ•—: ${error}`,
    });
  }
});
```

---

### æ¸¬è©¦é©—æ”¶

- [ ] Slack å®Œæˆé€šçŸ¥é¡¯ç¤ºã€Œç™¼é€ SMS çµ¦å®¢æˆ¶ã€æŒ‰éˆ•ï¼ˆç•¶æœ‰é›»è©±æ™‚ï¼‰
- [ ] é»æ“ŠæŒ‰éˆ•å¾Œï¼Œé¡¯ç¤ºç¢ºèªå°è©±æ¡†
- [ ] å°è©±æ¡†ä¸­é¡¯ç¤ºå®¢æˆ¶é›»è©±å’Œ SMS å…§å®¹é è¦½
- [ ] é»æ“Šã€Œç™¼é€ã€å¾Œï¼ŒæˆåŠŸèª¿ç”¨ API ç™¼é€ SMS
- [ ] Slack æ”¶åˆ°ç™¼é€æˆåŠŸçš„é€šçŸ¥è¨Šæ¯
- [ ] å¦‚æœç™¼é€å¤±æ•—ï¼ŒSlack æ”¶åˆ°éŒ¯èª¤è¨Šæ¯

---

## æ¸¬è©¦é©—æ”¶æ¨™æº–

### åŠŸèƒ½æ¸¬è©¦

#### 1. é›»è©±è™Ÿç¢¼æ”¶é›†
- [ ] Slack Bot è¡¨å–®é¡¯ç¤ºã€Œå®¢æˆ¶é›»è©±ã€æ¬„ä½
- [ ] å¡«å¯«æœ‰æ•ˆå°ç£æ‰‹æ©Ÿè™Ÿç¢¼ï¼ˆ`0912345678`ï¼‰ï¼Œæ ¼å¼åŒ–ç‚º `0912-345-678`
- [ ] å¡«å¯«ç„¡æ•ˆè™Ÿç¢¼ï¼ˆ`123`ï¼‰ï¼Œæ¬„ä½è¢«å¿½ç•¥
- [ ] ä¸å¡«å¯«é›»è©±ï¼Œè¡¨å–®æ­£å¸¸æäº¤

#### 2. å…¬é–‹åˆ†äº«é€£çµ
- [ ] Queue Worker å®Œæˆè™•ç†å¾Œï¼ŒæˆåŠŸç”Ÿæˆ share token
- [ ] è¨ªå• `/share/{token}` é¡¯ç¤º MEDDIC åˆ†æï¼ˆä¸éœ€ç™»å…¥ï¼‰
- [ ] é é¢é¡¯ç¤º: å…¬å¸åç¨±ã€æ¡ˆä»¶ç·¨è™Ÿã€MEDDIC åˆ†æ•¸ã€ç¶­åº¦åˆ†æã€ä¸‹ä¸€æ­¥è¡Œå‹•
- [ ] è¨ªå•ç„¡æ•ˆ token é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
- [ ] è¨ªå•éæœŸ tokenï¼ˆ7å¤©å¾Œï¼‰é¡¯ç¤ºéæœŸè¨Šæ¯

#### 3. SMS ç™¼é€
- [ ] é»æ“Š Slackã€Œç™¼é€ SMSã€æŒ‰éˆ•ï¼Œé¡¯ç¤ºç¢ºèªå°è©±æ¡†
- [ ] å°è©±æ¡†é¡¯ç¤ºå®¢æˆ¶é›»è©±å’Œ SMS å…§å®¹é è¦½
- [ ] é»æ“Šã€Œç™¼é€ã€ï¼ŒæˆåŠŸèª¿ç”¨ EVERY8D API
- [ ] å®¢æˆ¶æ”¶åˆ° SMSï¼Œå…§å®¹æ­£ç¢º
- [ ] SMS ä¸­çš„é€£çµå¯ä»¥é–‹å•Ÿå…¬é–‹åˆ†äº«é é¢

#### 4. ç™¼é€è¨˜éŒ„
- [ ] ç™¼é€æˆåŠŸå¾Œï¼Œ`sms_logs` è¡¨æ ¼æ–°å¢è¨˜éŒ„
- [ ] è¨˜éŒ„åŒ…å«: phoneNumber, message, statusCode, deliveredAt
- [ ] ç™¼é€å¤±æ•—æ™‚ï¼Œ`errorDetails` è¨˜éŒ„éŒ¯èª¤åŸå› 

---

### é‚Šç•Œæƒ…æ³æ¸¬è©¦

#### 1. æ²’æœ‰é›»è©±è™Ÿç¢¼
- [ ] Slack é€šçŸ¥ã€Œä¸é¡¯ç¤ºã€ç™¼é€ SMS æŒ‰éˆ•
- [ ] æ¥­å‹™ä»å¯æŸ¥çœ‹å®Œæ•´åˆ†æï¼ˆç¶²é ç‰ˆï¼‰

#### 2. é›»è©±è™Ÿç¢¼æ ¼å¼è®ŠåŒ–
- [ ] `0912345678` â†’ æ ¼å¼åŒ–ç‚º `0912-345-678`
- [ ] `0912-345-678` â†’ ä¿æŒä¸è®Š
- [ ] `09-1234-5678` â†’ æ ¼å¼åŒ–ç‚º `0912-345-678`
- [ ] `123` â†’ å¿½ç•¥ï¼ˆç„¡æ•ˆï¼‰

#### 3. Token å®‰å…¨æ€§
- [ ] Token ä½¿ç”¨åŠ å¯†ç°½åï¼Œç„¡æ³•å½é€ 
- [ ] Token éæœŸå¾Œç„¡æ³•è¨ªå•
- [ ] æ’¤éŠ·çš„ token ç„¡æ³•è¨ªå•

#### 4. SMS ç™¼é€å¤±æ•—
- [ ] EVERY8D API éŒ¯èª¤ â†’ è¨˜éŒ„éŒ¯èª¤æ—¥èªŒ
- [ ] ç¶²è·¯éŒ¯èª¤ â†’ é‡è©¦æ©Ÿåˆ¶ï¼ˆå¾…å¯¦ä½œï¼‰
- [ ] Slack é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯

---

### æ•ˆèƒ½æ¸¬è©¦

#### 1. Token ç”Ÿæˆæ•ˆèƒ½
- [ ] ç”Ÿæˆ token < 100ms
- [ ] å„²å­˜åˆ°è³‡æ–™åº« < 200ms

#### 2. å…¬é–‹é é¢è¼‰å…¥
- [ ] é¦–æ¬¡è¨ªå•ï¼ˆCache Missï¼‰< 1s
- [ ] å¾ŒçºŒè¨ªå•ï¼ˆCache Hitï¼‰< 300ms

#### 3. SMS ç™¼é€æ•ˆèƒ½
- [ ] EVERY8D API å›æ‡‰ < 3s
- [ ] è¨˜éŒ„åˆ°è³‡æ–™åº« < 200ms

---

## éƒ¨ç½²æª¢æŸ¥æ¸…å–®

### é–‹ç™¼ç’°å¢ƒ

- [ ] å»ºç«‹ `share_tokens` è³‡æ–™è¡¨ï¼ˆåŸ·è¡Œ migrationï¼‰
- [ ] è¨­å®š EVERY8D æ¸¬è©¦å¸³è™Ÿ
- [ ] è¨­å®šç’°å¢ƒè®Šæ•¸ï¼ˆ`.dev.vars`ï¼‰:
  ```
  EVERY8D_API_URL=https://oms.every8d.com/API21/HTTP/sendSMS.ashx
  EVERY8D_USERNAME=test_user
  EVERY8D_PASSWORD=test_pass
  SHARE_TOKEN_SECRET=dev-secret-key-change-in-prod
  WEB_APP_URL=http://localhost:5173
  ```
- [ ] æ¸¬è©¦å®Œæ•´æµç¨‹

---

### ç”Ÿç”¢ç’°å¢ƒ

- [ ] åŸ·è¡Œè³‡æ–™åº« migration
- [ ] ä½¿ç”¨ `wrangler secret put` è¨­å®šç’°å¢ƒè®Šæ•¸:
  ```bash
  bun wrangler secret put EVERY8D_API_URL
  bun wrangler secret put EVERY8D_USERNAME
  bun wrangler secret put EVERY8D_PASSWORD
  bun wrangler secret put SHARE_TOKEN_SECRET
  bun wrangler secret put WEB_APP_URL
  ```
- [ ] éƒ¨ç½² API Server
- [ ] éƒ¨ç½² Queue Worker
- [ ] éƒ¨ç½² Slack Bot
- [ ] éƒ¨ç½²å‰ç«¯ï¼ˆåŒ…å« `/share/$token` é é¢ï¼‰
- [ ] æ¸¬è©¦å®Œæ•´æµç¨‹
- [ ] ç›£æ§ EVERY8D é»æ•¸é¤˜é¡

---

## æˆæœ¬ä¼°ç®—

### EVERY8D æœˆæˆæœ¬

å‡è¨­:
- æ¯æ—¥è™•ç† 20 å€‹ conversations
- å…¶ä¸­ 85% æœ‰é›»è©±è™Ÿç¢¼ = 17 å‰‡ SMS/day
- æ¯æœˆ = 17 Ã— 30 = 510 å‰‡ SMS/month
- æ¯å‰‡ SMS æˆæœ¬ = NT$1.5

**æœˆæˆæœ¬**: 510 Ã— NT$1.5 = **NT$765/æœˆ**

---

## é™„éŒ„

### A. å°ç£æ‰‹æ©Ÿè™Ÿç¢¼æ ¼å¼è¦ç¯„

| æ ¼å¼ | ç¯„ä¾‹ | æ˜¯å¦æœ‰æ•ˆ |
|------|------|---------|
| æ¨™æº–æ ¼å¼ | `0912-345-678` | âœ… |
| ç„¡åˆ†éš”ç¬¦ | `0912345678` | âœ… (è‡ªå‹•æ ¼å¼åŒ–) |
| å…¶ä»–åˆ†éš” | `09-1234-5678` | âœ… (è‡ªå‹•æ ¼å¼åŒ–) |
| éŒ¯èª¤æ ¼å¼ | `123` | âŒ (å¿½ç•¥) |
| éŒ¯èª¤é–‹é ­ | `0812345678` | âŒ (å¿½ç•¥) |
| é•·åº¦éŒ¯èª¤ | `09123456789` | âŒ (å¿½ç•¥) |

### B. SMS å­—æ•¸è¨ˆç®—

| å…§å®¹ | å­—æ•¸ | ç°¡è¨Šå‰‡æ•¸ |
|------|------|---------|
| ç²¾ç°¡ç‰ˆï¼ˆæ¨è–¦ï¼‰ | ~70 å­— | 1 å‰‡ |
| å«è©³ç´°è³‡è¨Š | ~140 å­— | 2 å‰‡ |
| é•·ç°¡è¨Š | > 140 å­— | 3+ å‰‡ |

**å»ºè­°**: ä½¿ç”¨ç²¾ç°¡ç‰ˆï¼ˆ70 å­—å…§ï¼‰ï¼Œå¼•å°å®¢æˆ¶é»æ“Šé€£çµæŸ¥çœ‹è©³ç´°è³‡è¨Šã€‚

### C. Share Token å®‰å…¨æ€§

| å®‰å…¨æªæ–½ | èªªæ˜ |
|---------|------|
| åŠ å¯†ç°½å | HMAC-SHA256 ç°½åï¼Œç„¡æ³•å½é€  |
| éæœŸæ™‚é–“ | 7 å¤©å¾Œè‡ªå‹•å¤±æ•ˆ |
| æ’¤éŠ·æ©Ÿåˆ¶ | å¯æ‰‹å‹•æ’¤éŠ· token |
| æŸ¥çœ‹è¿½è¹¤ | è¨˜éŒ„æŸ¥çœ‹æ¬¡æ•¸å’Œæ™‚é–“ |
| å”¯ä¸€æ€§ | æ¯å€‹ conversation ç¨ç«‹ token |

---

**æ–‡ä»¶ç‰ˆæœ¬**: 1.0
**æœ€å¾Œæ›´æ–°**: 2026-01-20
**ç¶­è­·è€…**: Claude & Stephen
**é ä¼°å®Œæˆæ™‚é–“**: 2-3 å°æ™‚
