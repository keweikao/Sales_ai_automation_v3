# Web 應用部署狀態

**日期**: 2026-01-20
**狀態**: ✅ 程式碼完成 | ⚠️ 建置待解決

---

## 已完成項目

### 1. 資料庫 Schema 擴充 ✅

**檔案**: packages/db/src/schema/opportunity.ts

新增 5 個業務脈絡欄位:
- `storeType` - 店型/店鋪類型
- `serviceType` - 營運型態 (iCHEF only)
- `staffCount` - 員工數量 (Beauty only)
- `currentSystem` - 現有POS系統
- `decisionMakerPresent` - 決策者在場 (yes/no/unknown)

### 2. 資料庫 Migration ✅

**檔案**: packages/db/migrations/0004_add_opportunity_business_context.sql

```sql
ALTER TABLE opportunities
ADD COLUMN IF NOT EXISTS store_type TEXT,
ADD COLUMN IF NOT EXISTS service_type TEXT,
ADD COLUMN IF NOT EXISTS staff_count TEXT,
ADD COLUMN IF NOT EXISTS current_system TEXT,
ADD COLUMN IF NOT EXISTS decision_maker_present TEXT;
```

**執行狀態**: ⚠️ 待執行

### 3. API Schema 和 Handler 更新 ✅

**檔案**: packages/api/src/routers/opportunity.ts

- createOpportunitySchema 和 updateOpportunitySchema 新增 5 個欄位
- source enum 加入 "slack" 選項
- Create/Update handlers 支援新欄位

### 4. Web 元件和頁面更新 ✅

- ProductConfigFormFields 元件已建立
- 新增商機頁面已整合產品線選擇和動態欄位

---

## 建置問題

### Vite 解析錯誤

```
[vite]: Rollup failed to resolve import "@sales_ai_automation_v3/shared/product-configs"
```

### 根本原因

Workspace 名稱衝突:
- apps/slack-bot/package.json: "name": "slack-bot"
- apps/slack-bot-beauty/package.json: "name": "slack-bot"

導致無法重新安裝依賴。

---

## 建議方案

**優先執行**: 先部署後端服務 (API 已支援新欄位)

1. 執行資料庫 Migration
2. 部署 Server 和 Queue Worker
3. 稍後修復 Workspace 名稱衝突
4. 重新建置並部署 Web 應用

---

**最後更新**: 2026-01-20
