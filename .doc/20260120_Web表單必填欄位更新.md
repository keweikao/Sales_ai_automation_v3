# Web 表單必填欄位更新

**日期**: 2026-01-20
**狀態**: ✅ 已完成並部署

---

## 🎯 更新目的

將 Web 新增商機表單的業務脈絡欄位改為**必填**,與 Slack Modal 保持一致,確保所有管道建立的商機都包含完整的業務資訊。

---

## ✅ 變更內容

### 1. 表單驗證邏輯更新

**檔案**: [apps/web/src/routes/opportunities/new.tsx](../../apps/web/src/routes/opportunities/new.tsx)

**新增驗證規則**:
```typescript
const handleSubmit = (e: React.FormEvent) => {
  e.preventDefault();

  // 基本必填
  if (!formData.customerNumber || !formData.companyName) {
    toast.error("請填寫客戶編號和公司名稱");
    return;
  }

  // 業務脈絡必填 (與 Slack 一致)
  if (!formData.storeType) {
    toast.error("請選擇店型");
    return;
  }

  if (formData.productLine === "ichef" && !formData.serviceType) {
    toast.error("請選擇營運型態");
    return;
  }

  if (formData.productLine === "beauty" && !formData.staffCount) {
    toast.error("請選擇員工數量");
    return;
  }

  if (!formData.currentSystem) {
    toast.error("請選擇現有POS系統");
    return;
  }

  createMutation.mutate();
};
```

### 2. 必填欄位標記

**元件**: [ProductConfigFormFields.tsx](../../apps/web/src/components/opportunities/ProductConfigFormFields.tsx)

所有業務脈絡欄位自動顯示紅色星號 `*`,因為 Product Config 已將 `required: true`。

---

## 📋 目前必填欄位清單

### 所有產品線共同必填
1. ✅ **客戶編號** - 基本資訊
2. ✅ **公司名稱** - 基本資訊
3. ✅ **產品線** - 自動預設為 iCHEF
4. ✅ **店型** - 業務脈絡 (與 Slack 一致)
5. ✅ **現有POS系統** - 業務脈絡 (與 Slack 一致)

### iCHEF 產品線額外必填
6. ✅ **營運型態** - 業務脈絡 (與 Slack 一致)

### Beauty 產品線額外必填
6. ✅ **員工數量** - 業務脈絡 (與 Slack 一致)

### 選填欄位
- 決策者在場
- 聯絡人
- Email
- 電話
- 產業
- 公司規模
- 狀態 (預設: 新建立)
- 來源 (預設: 手動建立)
- 備註

---

## 🔄 與 Slack Modal 的一致性

### Slack Modal 必填欄位
```
1. 客戶編號 *
2. 客戶名稱 *
3. 店型 *
4. 營運型態 * (iCHEF) / 員工數量 * (Beauty)
5. 現有POS系統 *
```

### Web 表單必填欄位 (更新後)
```
1. 客戶編號 *
2. 公司名稱 *
3. 產品線 * (預設)
4. 店型 *
5. 營運型態 * (iCHEF) / 員工數量 * (Beauty)
6. 現有POS系統 *
```

✅ **核心業務脈絡欄位完全一致**

---

## 🌐 部署資訊

**部署 URL**: https://cbb81b4c.sales-ai-web.pages.dev

### 測試步驟
1. 開啟 https://cbb81b4c.sales-ai-web.pages.dev/opportunities/new
2. 嘗試不填寫業務脈絡欄位直接提交
3. 應該看到對應的錯誤訊息:
   - "請選擇店型"
   - "請選擇營運型態" (iCHEF)
   - "請選擇員工數量" (Beauty)
   - "請選擇現有POS系統"
4. 填寫完整必填欄位後應該可以成功提交

---

## 📊 預期效果

### 資料品質提升
- ✅ **100% 商機包含業務脈絡**: 所有新建商機都有店型、系統等關鍵資訊
- ✅ **MEDDIC 分析更準確**: 完整的業務脈絡提升分析品質
- ✅ **報表更有價值**: 可按店型、現有系統等維度分析

### 使用者體驗
- ✅ **清晰的引導**: 紅色星號明確標示必填欄位
- ✅ **即時驗證**: 提交時立即顯示缺少的欄位
- ✅ **減少錯誤**: 避免建立不完整的商機資料

### 系統一致性
- ✅ **多管道一致**: Web 和 Slack 收集的資料結構相同
- ✅ **資料完整性**: 確保所有商機都有分析所需的最小資訊集
- ✅ **易於維護**: 必填邏輯集中在 Product Config

---

## 🔍 驗證檢查清單

### 功能驗證
- [ ] 不填店型無法提交,顯示錯誤訊息
- [ ] iCHEF 產品線不填營運型態無法提交
- [ ] Beauty 產品線不填員工數量無法提交
- [ ] 不填現有系統無法提交
- [ ] 填寫所有必填欄位可成功提交
- [ ] 選填欄位為空也能成功提交

### 視覺驗證
- [ ] 所有必填欄位標籤旁有紅色 `*`
- [ ] 產品線切換時動態欄位正確顯示
- [ ] 錯誤訊息清晰易懂

### 資料驗證
- [ ] 提交後資料庫正確儲存所有欄位
- [ ] API 回傳包含所有業務脈絡欄位
- [ ] 與 Slack 建立的商機資料結構一致

---

## 📝 後續建議

### 短期
1. **監控提交成功率**: 檢查必填欄位是否影響表單完成率
2. **收集使用者反饋**: 詢問業務團隊必填欄位是否合理
3. **資料品質分析**: 驗證新商機的業務脈絡資料完整性

### 中期
1. **欄位預填充**: 根據客戶編號自動帶入已知資訊
2. **智能推薦**: 根據公司名稱智能推薦店型
3. **批量匯入**: 支援 CSV 批量建立商機時驗證必填欄位

---

**完成時間**: 2026-01-20
**部署版本**: cbb81b4c
**狀態**: ✅ 已上線
