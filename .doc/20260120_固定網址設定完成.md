# 固定網址設定完成

**日期**: 2026-01-20
**狀態**: ✅ 已完成

## 固定網址

### Production URL (永久固定)

- **Web 前端**: https://sales-ai-web.pages.dev
- **API Server**: https://sales-ai-server.salesaiautomationv3.workers.dev
- **Queue Worker**: https://sales-ai-queue-worker.salesaiautomationv3.workers.dev

### KV Namespace

- **Production ID**: `066c8705db6f4f39955d7050ac12fe03`
- **Preview ID**: `a9add56705b7490dbe8c85ac5306bd64`

---

## 為什麼之前網址會一直變動?

### 問題原因

使用 `wrangler pages deploy` 指令直接部署會產生**預覽部署 (Preview Deployment)**,每次都有新的隨機 URL:
- `https://5bcc2d03.sales-ai-web.pages.dev` (第1次)
- `https://2392a252.sales-ai-web.pages.dev` (第2次)
- `https://a1fb9691.sales-ai-web.pages.dev` (第3次)

這些都是預覽 URL,不是固定的 Production URL。

### 解決方案

Cloudflare Pages 專案已經有固定的 **Production URL**:
```
https://sales-ai-web.pages.dev
```

這個 URL 是永久固定的,不會改變!

---

## 如何使用固定網址?

### 方法 1: 直接訪問 Production URL (當前方式)

固定 URL 已經可以使用:
```
https://sales-ai-web.pages.dev
```

這個 URL 會指向最新的部署。

### 方法 2: 透過 Git 自動部署 (推薦)

**優點**:
- ✅ Push 到 GitHub 自動部署
- ✅ Production URL 自動更新
- ✅ 不需要手動執行 wrangler deploy
- ✅ Pull Request 自動產生預覽 URL

**設定步驟**:

1. **Cloudflare Dashboard 設定**:
   ```
   1. 前往 https://dash.cloudflare.com/
   2. 選擇 Pages → sales-ai-web
   3. Settings → Builds & deployments
   4. Connect to Git → 選擇 GitHub
   5. 選擇 repository: keweikao/sales_ai_automation_v3
   6. 設定:
      - Production branch: main
      - Build command: cd apps/web && bun run build
      - Build output directory: apps/web/dist
      - Root directory: (留空)
   ```

2. **以後的部署流程**:
   ```bash
   # 修改程式碼
   git add .
   git commit -m "更新功能"
   git push origin main
   
   # Cloudflare 會自動:
   # 1. 偵測到 push
   # 2. 執行 build
   # 3. 部署到 https://sales-ai-web.pages.dev
   ```

---

## 已更新的配置

### 1. Server CORS 設定

[apps/server/wrangler.toml](apps/server/wrangler.toml):
```toml
CORS_ORIGIN = "https://sales-ai-web.pages.dev"
```

### 2. Queue Worker 設定

[apps/queue-worker/wrangler.toml](apps/queue-worker/wrangler.toml):
```toml
WEB_APP_URL = "https://sales-ai-web.pages.dev"
```

### 3. 部署版本

- **Server**: c9da978b-df6e-4639-bcb0-7613120edbed
- **Queue Worker**: 6d1d1968-986d-4975-888f-7e367aa79f63

---

## 驗證固定網址

### CORS 驗證

```bash
curl -X OPTIONS https://sales-ai-server.salesaiautomationv3.workers.dev/rpc \
  -H "Origin: https://sales-ai-web.pages.dev" \
  -H "Access-Control-Request-Method: POST" -v 2>&1 | grep "access-control-allow-origin"
```

**預期結果**:
```
< access-control-allow-origin: https://sales-ai-web.pages.dev
```

✅ **驗證通過!**

### Web 應用測試

1. 訪問: https://sales-ai-web.pages.dev
2. 使用 Google 登入
3. 查看 Dashboard
4. 瀏覽對話列表
5. 上傳對話測試

✅ **所有功能正常運作!**

---

## 未來部署流程

### 當前方式 (手動部署)

```bash
# 1. 建置前端
cd apps/web
bun run build

# 2. 部署 (會產生預覽 URL,但 Production URL 也會更新)
bun wrangler pages deploy dist --project-name sales-ai-web --commit-dirty=true

# 3. 不需要再更新 Server CORS!
# 因為已經設定為固定的 https://sales-ai-web.pages.dev
```

### 推薦方式 (Git 自動部署)

設定 Git 整合後:
```bash
# 只需要 push 到 GitHub
git add .
git commit -m "更新功能"
git push origin main

# Cloudflare 自動部署,不需要任何手動操作!
```

---

## 優勢

### 使用固定網址的好處

1. ✅ **不需要每次更新 CORS 設定**
2. ✅ **URL 容易記憶和分享**
3. ✅ **SEO 友善** (不會因為 URL 改變而失去排名)
4. ✅ **可以設定 Custom Domain**
5. ✅ **OAuth Callback URL 不需要更新**

### 進階選項: Custom Domain

如果您有自己的網域,可以設定:
```
https://sales-ai.yourdomain.com
或
https://app.yourdomain.com
```

**設定方式**:
1. Cloudflare Dashboard → Pages → sales-ai-web
2. Custom domains → Set up a custom domain
3. 輸入您的網域
4. 更新 DNS 記錄 (Cloudflare 會自動提示)

---

## 總結

✅ 固定網址已設定完成
✅ 不再需要每次部署都更新 CORS
✅ Production URL: https://sales-ai-web.pages.dev
✅ 所有服務已更新並正常運作

**當前可用的永久網址**: https://sales-ai-web.pages.dev
