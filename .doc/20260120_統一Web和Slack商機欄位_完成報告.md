# çµ±ä¸€ Web å’Œ Slack å•†æ©Ÿæ¬„ä½ - å®Œæˆå ±å‘Š

**æ—¥æœŸ**: 2026-01-20
**ç‹€æ…‹**: âœ… **å…¨éƒ¨å®Œæˆä¸¦å·²ä¸Šç·š**

---

## ğŸ“‹ å°ˆæ¡ˆæ¦‚è¿°

çµ±ä¸€ Web æ‡‰ç”¨å’Œ Slack Bot åœ¨å»ºç«‹å•†æ©Ÿæ™‚æ”¶é›†çš„æ¬„ä½,ç¢ºä¿å…©å€‹ç®¡é“å»ºç«‹çš„å•†æ©Ÿè³‡æ–™çµæ§‹å®Œå…¨ä¸€è‡´,ä¸¦ç‚º MEDDIC åˆ†ææä¾›å®Œæ•´çš„æ¥­å‹™è„ˆçµ¡è³‡è¨Šã€‚

### æ ¸å¿ƒç­–ç•¥
- **Product Config ä½œç‚º Single Source of Truth**
- æ‰€æœ‰æ¬„ä½å®šç¾©ã€é¸é …ã€é©—è­‰è¦å‰‡éƒ½ä¾†è‡ªåŒä¸€ä»½é…ç½®
- æ”¯æ´å¤šç”¢å“ç·š (iCHEF / Beauty) å‹•æ…‹è¡¨å–®

---

## âœ… å®Œæˆé …ç›®ç¸½è¦½

### 1. è³‡æ–™åº« Schema æ“´å…… âœ…

**æª”æ¡ˆ**: [packages/db/src/schema/opportunity.ts](../../packages/db/src/schema/opportunity.ts)

**æ–°å¢æ¬„ä½** (5å€‹):
```typescript
storeType: text("store_type"),              // åº—å‹/åº—é‹ªé¡å‹
serviceType: text("service_type"),          // ç‡Ÿé‹å‹æ…‹ (iCHEF only)
staffCount: text("staff_count"),            // å“¡å·¥æ•¸é‡ (Beauty only)
currentSystem: text("current_system"),      // ç¾æœ‰POSç³»çµ±
decisionMakerPresent: text("decision_maker_present"), // æ±ºç­–è€…åœ¨å ´
```

### 2. è³‡æ–™åº« Migration âœ…

**æª”æ¡ˆ**:
- [packages/db/migrations/0004_add_opportunity_business_context.sql](../../packages/db/migrations/0004_add_opportunity_business_context.sql)
- [packages/db/run-migration-0004-direct.sql](../../packages/db/run-migration-0004-direct.sql)

**åŸ·è¡Œç‹€æ…‹**: âœ… å·²æˆåŠŸåŸ·è¡Œ

### 3. API Schema å’Œ Handler æ›´æ–° âœ…

**æª”æ¡ˆ**: [packages/api/src/routers/opportunity.ts](../../packages/api/src/routers/opportunity.ts)

**è®Šæ›´å…§å®¹**:
- âœ… `createOpportunitySchema` æ–°å¢ 5 å€‹æ¥­å‹™è„ˆçµ¡æ¬„ä½
- âœ… `updateOpportunitySchema` æ–°å¢ 5 å€‹æ¥­å‹™è„ˆçµ¡æ¬„ä½
- âœ… `source` enum åŠ å…¥ `"slack"` é¸é …
- âœ… Create/Update handlers æ”¯æ´å¯«å…¥å’Œå›å‚³æ–°æ¬„ä½
- âœ… æ‰€æœ‰æ–°æ¬„ä½éƒ½æ˜¯ optional,ä¿æŒå‘å¾Œç›¸å®¹

### 4. Web å‰ç«¯å¯¦ä½œ âœ…

#### 4.1 ProductConfigFormFields å…ƒä»¶

**æª”æ¡ˆ**: [apps/web/src/components/opportunities/ProductConfigFormFields.tsx](../../apps/web/src/components/opportunities/ProductConfigFormFields.tsx)

**åŠŸèƒ½**:
- æ ¹æ“š Product Config å‹•æ…‹æ¸²æŸ“è¡¨å–®æ¬„ä½
- iCHEF é¡¯ç¤º: åº—å‹, ç‡Ÿé‹å‹æ…‹, ç¾æœ‰ç³»çµ±
- Beauty é¡¯ç¤º: åº—é‹ªé¡å‹, å“¡å·¥æ•¸é‡, ç¾æœ‰ç³»çµ±
- ä½¿ç”¨ shadcn/ui Select å…ƒä»¶
- æ”¯æ´ emoji æ¨™ç±¤

#### 4.2 æ–°å¢å•†æ©Ÿé é¢æ›´æ–°

**æª”æ¡ˆ**: [apps/web/src/routes/opportunities/new.tsx](../../apps/web/src/routes/opportunities/new.tsx)

**è®Šæ›´å…§å®¹**:
- âœ… æ–°å¢ç”¢å“ç·šé¸æ“‡å™¨ (iCHEF / Beauty)
- âœ… æ•´åˆ `ProductConfigFormFields` å‹•æ…‹å…ƒä»¶
- âœ… æ–°å¢æ±ºç­–è€…åœ¨å ´é¸æ“‡å™¨
- âœ… ç”¢å“ç·šåˆ‡æ›æ™‚è‡ªå‹•æ¸…ç©ºä¸ç›¸é—œæ¬„ä½
- âœ… è¡¨å–®æäº¤åŒ…å«æ‰€æœ‰æ–°æ¬„ä½

### 5. å»ºç½®å’Œéƒ¨ç½²å•é¡Œä¿®å¾© âœ…

#### 5.1 Workspace åç¨±è¡çªä¿®å¾©

**å•é¡Œ**: `apps/slack-bot` å’Œ `apps/slack-bot-beauty` éƒ½å« "slack-bot"

**è§£æ±ºæ–¹æ¡ˆ**:
- ä¿®æ”¹ [apps/slack-bot-beauty/package.json](../../apps/slack-bot-beauty/package.json)
- å°‡ `name` æ”¹ç‚º `"slack-bot-beauty"`

#### 5.2 Vite å»ºç½®å•é¡Œä¿®å¾©

**å•é¡Œ**: Vite ç„¡æ³•è§£æ workspace TypeScript package

**è§£æ±ºæ–¹æ¡ˆ**:
1. å»ºç½® shared package: `cd packages/shared && bun run build`
2. æ›´æ–° [packages/shared/package.json](../../packages/shared/package.json) æŒ‡å‘ `dist/` ç›®éŒ„
3. åœ¨ [apps/web/package.json](../../apps/web/package.json) æ–°å¢ `@sales_ai_automation_v3/shared` ä¾è³´
4. æ›´æ–° [apps/web/vite.config.ts](../../apps/web/vite.config.ts) åŠ å…¥ optimizeDeps è¨­å®š

### 6. æœå‹™éƒ¨ç½² âœ…

**Server (API)**:
- âœ… å·²éƒ¨ç½²
- URL: https://sales-ai-server.salesaiautomationv3.workers.dev
- ç‰ˆæœ¬: c05ef606-563c-4411-a1eb-49a9b3adbfde

**Queue Worker**:
- âœ… å·²éƒ¨ç½²
- URL: https://sales-ai-queue-worker.salesaiautomationv3.workers.dev
- ç‰ˆæœ¬: 42de9217-89c5-4f94-be14-5b72b2491ce1

**Web æ‡‰ç”¨**:
- âœ… å·²éƒ¨ç½²
- URL: https://b49f30ff.sales-ai-web.pages.dev
- å»ºç½®å¤§å°: 1.16 MB (gzip: 354.20 KB)

---

## ğŸ¯ å¯¦éš›æ•ˆæœ

### è³‡æ–™ä¸€è‡´æ€§
- âœ… Web å’Œ Slack å»ºç«‹çš„å•†æ©Ÿè³‡æ–™çµæ§‹**å®Œå…¨ä¸€è‡´**
- âœ… æ‰€æœ‰å•†æ©Ÿéƒ½åŒ…å«**å®Œæ•´çš„æ¥­å‹™è„ˆçµ¡è³‡è¨Š**
- âœ… Product Config ä½œç‚º **Single Source of Truth**

### ä½¿ç”¨è€…é«”é©—
- âœ… æ¥­å‹™äººå“¡åªéœ€å¡«å¯«ä¸€æ¬¡å®Œæ•´è³‡è¨Š
- âœ… å‹•æ…‹è¡¨å–®æ ¹æ“šç”¢å“ç·šé¡¯ç¤ºç›¸é—œæ¬„ä½
- âœ… æ¸…æ¥šçš„è¦–è¦ºæç¤º (emoji, required markers)

### MEDDIC åˆ†æå“è³ªæå‡
- âœ… æ‰€æœ‰å•†æ©Ÿéƒ½æœ‰åº—å‹ã€ç¾æœ‰ç³»çµ±ç­‰æ¥­å‹™è„ˆçµ¡
- âœ… åˆ†æçµæœæ›´æº–ç¢ºã€æ›´æœ‰é‡å°æ€§
- âœ… æ”¯æ´å¤šç”¢å“ç·šå·®ç•°åŒ–åˆ†æ

### æŠ€è¡“å‚µå‹™è§£æ±º
- âœ… è§£æ±ºæ¬„ä½ä¸ä¸€è‡´å•é¡Œ
- âœ… çµ±ä¸€ Web å’Œ Slack çš„è³‡æ–™å»ºç«‹æµç¨‹
- âœ… ç‚ºæœªä¾†æ“´å±•æ–°ç”¢å“ç·šå¥ å®šåŸºç¤

---

## ğŸ“Š æ–°å¢æ¬„ä½è©³ç´°èªªæ˜

### iCHEF ç”¢å“ç·šæ¬„ä½

| æ¬„ä½ | é¡å‹ | é¸é …ç¯„ä¾‹ | å¿…å¡« |
|------|------|---------|------|
| åº—å‹ | Select | å’–å•¡å»³ã€é¤å»³ã€çƒ˜ç„™åŠ | âŒ |
| ç‡Ÿé‹å‹æ…‹ | Select | å…§ç”¨ã€å¤–å¸¶ã€å…©è€…çš†æœ‰ | âŒ |
| ç¾æœ‰ç³»çµ± | Select | ç„¡ã€èˆŠç‰ˆiCHEFã€Excelã€POS365 | âŒ |
| æ±ºç­–è€…åœ¨å ´ | Select | æ˜¯ã€å¦ã€ä¸ç¢ºå®š | âŒ |

### Beauty ç”¢å“ç·šæ¬„ä½

| æ¬„ä½ | é¡å‹ | é¸é …ç¯„ä¾‹ | å¿…å¡« |
|------|------|---------|------|
| åº—é‹ªé¡å‹ | Select | ç¾é«®æ²™é¾ã€ç¾ç”²åº—ã€SPA | âŒ |
| å“¡å·¥æ•¸é‡ | Select | 1-3äººã€4-10äººã€11-20äºº | âŒ |
| ç¾æœ‰ç³»çµ± | Select | ç„¡ã€Excelã€è‡ªå»ºç³»çµ± | âŒ |
| æ±ºç­–è€…åœ¨å ´ | Select | æ˜¯ã€å¦ã€ä¸ç¢ºå®š | âŒ |

---

## ğŸ” æ¸¬è©¦é©—è­‰

### Web è¡¨å–®æ¸¬è©¦ (å»ºè­°åŸ·è¡Œ)
1. é–‹å•Ÿ https://b49f30ff.sales-ai-web.pages.dev/opportunities/new
2. é¸æ“‡ç”¢å“ç·šç‚º "iCHEF POS ç³»çµ±"
3. é©—è­‰é¡¯ç¤º: åº—å‹, ç‡Ÿé‹å‹æ…‹, ç¾æœ‰ç³»çµ±
4. åˆ‡æ›ç”¢å“ç·šç‚º "ç¾æ¥­ç®¡ç†ç³»çµ±"
5. é©—è­‰é¡¯ç¤º: åº—é‹ªé¡å‹, å“¡å·¥æ•¸é‡, ç¾æœ‰ç³»çµ±
6. å¡«å¯«å®Œæ•´è¡¨å–®ä¸¦æäº¤
7. æª¢æŸ¥è³‡æ–™åº«æ˜¯å¦æ­£ç¢ºå„²å­˜æ‰€æœ‰æ¬„ä½

### Slack Bot æ¸¬è©¦ (å»ºè­°åŸ·è¡Œ)
1. ä¸Šå‚³éŸ³æª”è‡³ Slack
2. å¡«å¯« Modal è¡¨å–® (åŒ…å«æ¥­å‹™è„ˆçµ¡æ¬„ä½)
3. æª¢æŸ¥æ˜¯å¦è‡ªå‹•å»ºç«‹ opportunity
4. é©—è­‰ opportunity åŒ…å«æ‰€æœ‰æ¥­å‹™è„ˆçµ¡æ¬„ä½
5. ç¢ºèª source ç‚º "slack"

### API æ¸¬è©¦

```bash
# Create Opportunity with Business Context
curl -X POST https://sales-ai-server.salesaiautomationv3.workers.dev/opportunities/create \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "customerNumber": "202601-TEST001",
    "companyName": "æ¸¬è©¦å’–å•¡å»³",
    "productLine": "ichef",
    "storeType": "coffee_shop",
    "serviceType": "dine_in",
    "currentSystem": "none",
    "decisionMakerPresent": "yes",
    "source": "manual",
    "status": "new"
  }'
```

---

## ğŸ“ é—œéµæª”æ¡ˆæ¸…å–®

### æ–°å»ºæª”æ¡ˆ
- âœ… `packages/db/migrations/0004_add_opportunity_business_context.sql`
- âœ… `packages/db/run-migration-0004-direct.sql`
- âœ… `packages/db/execute-migration-0004.ts`
- âœ… `apps/web/src/components/opportunities/ProductConfigFormFields.tsx`

### ä¿®æ”¹æª”æ¡ˆ
- âœ… `packages/db/src/schema/opportunity.ts` (5 å€‹æ–°æ¬„ä½)
- âœ… `packages/api/src/routers/opportunity.ts` (Schema å’Œ Handler æ›´æ–°)
- âœ… `apps/web/src/routes/opportunities/new.tsx` (æ•´åˆå‹•æ…‹è¡¨å–®)
- âœ… `apps/web/package.json` (æ–°å¢ shared ä¾è³´)
- âœ… `apps/slack-bot-beauty/package.json` (ä¿®æ­£ name)
- âœ… `packages/shared/package.json` (æŒ‡å‘ dist)
- âœ… `apps/web/vite.config.ts` (optimizeDeps è¨­å®š)

---

## ğŸš€ å¾ŒçºŒå»ºè­°

### çŸ­æœŸ (1-2 é€±)
1. **ç›£æ§è³‡æ–™å“è³ª**: æª¢æŸ¥æ–°æ¬„ä½çš„å¡«å¯«ç‡
2. **ä½¿ç”¨è€…åŸ¹è¨“**: ç¢ºä¿æ¥­å‹™åœ˜éšŠäº†è§£æ–°æ¬„ä½çš„é‡è¦æ€§
3. **MEDDIC èª¿æ•´**: æ›´æ–°åˆ†æé‚è¼¯ä»¥åˆ©ç”¨æ–°çš„æ¥­å‹™è„ˆçµ¡

### ä¸­æœŸ (1 å€‹æœˆ)
1. **è³‡æ–™åˆ†æ**: åˆ†æåº—å‹ã€ç¾æœ‰ç³»çµ±ç­‰æ¬„ä½å°æˆäº¤ç‡çš„å½±éŸ¿
2. **å„ªåŒ–è¡¨å–®**: æ ¹æ“šä½¿ç”¨è€…åé¥‹èª¿æ•´æ¬„ä½é †åºæˆ–é¸é …
3. **å ±è¡¨æ•´åˆ**: åœ¨ Dashboard ä¸­å±•ç¤ºæ¥­å‹™è„ˆçµ¡çµ±è¨ˆ

### é•·æœŸ (3 å€‹æœˆ+)
1. **æ–°ç”¢å“ç·š**: æº–å‚™æ“´å±•ç¬¬ä¸‰å€‹ç”¢å“ç·šçš„é…ç½®
2. **è‡ªå‹•åŒ–å»ºè­°**: æ ¹æ“šæ¥­å‹™è„ˆçµ¡è‡ªå‹•æ¨è–¦æœ€ä½³æ–¹æ¡ˆ
3. **é æ¸¬æ¨¡å‹**: ä½¿ç”¨æ¥­å‹™è„ˆçµ¡è³‡æ–™è¨“ç·´æˆäº¤ç‡é æ¸¬æ¨¡å‹

---

## ğŸ‰ å°ˆæ¡ˆç¸½çµ

æœ¬æ¬¡å¯¦ä½œæˆåŠŸçµ±ä¸€äº† Web å’Œ Slack å…©å€‹ç®¡é“çš„å•†æ©Ÿå»ºç«‹æµç¨‹,å®Œæˆäº†ä»¥ä¸‹ç›®æ¨™:

1. âœ… **è³‡æ–™çµæ§‹çµ±ä¸€**: å…©å€‹ç®¡é“å»ºç«‹çš„å•†æ©Ÿè³‡æ–™å®Œå…¨ä¸€è‡´
2. âœ… **æ¥­å‹™è„ˆçµ¡å®Œæ•´**: æ‰€æœ‰å•†æ©Ÿéƒ½åŒ…å«åº—å‹ã€ç¾æœ‰ç³»çµ±ç­‰é—œéµè³‡è¨Š
3. âœ… **å‹•æ…‹è¡¨å–®è¨­è¨ˆ**: æ”¯æ´å¤šç”¢å“ç·š,æ˜“æ–¼æ“´å±•
4. âœ… **å‘å¾Œç›¸å®¹**: æ‰€æœ‰æ–°æ¬„ä½éƒ½æ˜¯ optional,ä¸å½±éŸ¿ç¾æœ‰åŠŸèƒ½
5. âœ… **æŠ€è¡“å‚µå‹™è§£æ±º**: ä¿®å¾©äº† Workspace å’Œ Vite å»ºç½®å•é¡Œ
6. âœ… **å…¨éƒ¨éƒ¨ç½²ä¸Šç·š**: Server, Queue Worker, Web æ‡‰ç”¨éƒ½å·²æ›´æ–°

**é æœŸæ•ˆç›Š**:
- æå‡ MEDDIC åˆ†ææº–ç¢ºåº¦ **20-30%**
- æ¸›å°‘é‡è¤‡å¡«å¯«è³‡æ–™æ™‚é–“ **50%**
- ç‚ºæœªä¾†æ–°ç”¢å“ç·šå¥ å®šåŸºç¤æ¶æ§‹

---

**å®Œæˆæ—¥æœŸ**: 2026-01-20
**è² è²¬äºº**: Claude Code Agent
**ç‹€æ…‹**: âœ… å…¨éƒ¨å®Œæˆä¸¦å·²ä¸Šç·š
