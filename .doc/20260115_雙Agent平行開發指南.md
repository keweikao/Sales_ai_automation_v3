# 雙 Agent 平行開發指南
# Parallel Development Guide

本文件說明如何使用 Agent A 和 Agent B 的計畫進行平行開發。

---

## 📋 計畫文件

### Agent A: 基礎設施與核心服務
**檔案:** `.doc/AGENT_A_INFRASTRUCTURE_PLAN.md`
**負責範圍:**
- Cloudflare Queue 配置
- 共享錯誤處理系統 (`packages/shared/errors`)
- Slack 通知服務
- R2 和 DB 工具模組
- Turborepo 配置
- Types 提取 (`packages/shared/types`)
- 基礎設施單元測試
- 性能測試
- 部署準備

**分支:** `feature/infrastructure`

### Agent B: 業務邏輯與整合
**檔案:** `.doc/AGENT_B_BUSINESS_LOGIC_PLAN.md`
**負責範圍:**
- API 介面定義與修改
- Queue Worker 轉錄邏輯
- MEDDIC 分析整合
- Schemas 提取 (`packages/shared/schemas`)
- 整合測試與 E2E 測試
- 壓力測試
- 部署執行

**分支:** `feature/business-logic`

---

## 🔄 依賴關係

### Week 1 依賴關係

```
Day 1:
  Agent A → Queue 基礎設施 + 錯誤系統 (獨立)
  Agent B → API Mock Queue (獨立)

  關鍵交付:
  - Agent A 提供 @Sales_ai_automation_v3/shared (錯誤 + 類型)
  - Agent B 創建 Mock Queue 先行開發

Day 2:
  Agent A → Slack 通知服務 (獨立)
  Agent B → Queue Worker 轉錄邏輯 (使用 Day 1 的錯誤系統)

  關鍵交付:
  - Agent A 提供 R2 工具模組
  - Agent B 完成轉錄處理

Day 3:
  Agent A → DB 工具 + Slack 整合 (獨立)
  Agent B → MEDDIC 分析整合 (使用 Agent A 的工具)

  關鍵交付:
  - Agent A 提供完整工具模組
  - Agent B 完成完整流程

Day 4:
  Agent A → 單元測試 (自己的模組)
  Agent B → 整合測試 (完整流程)

  平行進行,互不干擾

Day 5:
  共同 → Bug 修復與文檔
```

### Week 2 依賴關係

```
Day 1:
  Agent A → Turborepo 配置 (獨立)
  Agent B → 性能測試 (等待 Agent A 配置完成)

Day 2-3:
  Agent A → 提取 Types (獨立)
  Agent B → 提取 Schemas (獨立)

  完全平行,無依賴

Day 4:
  Agent A → tRPC POC (獨立)
  Agent B → tRPC 評估 (使用 Agent A 的 POC)

Day 5:
  共同 → 決策與文檔
```

### Week 3 依賴關係

```
Day 1-2:
  Agent A → 單元測試 (獨立)
  Agent B → 整合測試與 E2E (獨立)

  完全平行

Day 3:
  Agent A → 性能測試 (獨立)
  Agent B → 壓力測試 (獨立)

  完全平行

Day 4:
  Agent A → 部署準備 (獨立)
  Agent B → 部署執行 (等待 Agent A 準備完成)

Day 5:
  共同 → 監控與調優
```

---

## 📅 每日協調流程

### 上午同步 (9:00 AM, 15 分鐘)

**目的:** 對齊當日計畫,確認依賴關係

**議程:**
1. Agent A 分享今日計畫
2. Agent B 分享今日計畫
3. 確認依賴關係 (誰需要等誰)
4. 解決阻塞問題

**範例:**
```
Agent A: "今天上午會完成錯誤處理系統,下午發布 shared package"
Agent B: "我會先用 Mock 開發,等你下午發布後再替換"
```

### 下午同步 (3:00 PM, 15 分鐘)

**目的:** 更新進度,調整計畫

**議程:**
1. Agent A 分享上午進度
2. Agent B 分享上午進度
3. 更新交付物狀態
4. 調整下午計畫 (如需要)

**範例:**
```
Agent A: "錯誤系統已完成,shared package 已發布 v0.1.0"
Agent B: "太好了!我現在可以替換 Mock 了"
```

### 每日結束同步 (6:00 PM, 30 分鐘)

**目的:** Review 成果,規劃明日

**議程:**
1. Review 當日成果
2. 更新檢查清單 (tick off completed tasks)
3. 提交代碼
4. 合併到 develop 分支 (如無衝突)
5. 規劃明日工作

**範例:**
```
Agent A: "今天完成了 Queue 配置和錯誤系統,明天做 Slack 服務"
Agent B: "API 修改完成,Mock Queue 測試通過,明天整合轉錄邏輯"
```

---

## 🔀 代碼協調策略

### 分支策略

```
main
  └── develop
      ├── feature/infrastructure (Agent A)
      └── feature/business-logic (Agent B)
```

**流程:**
1. Agent A 在 `feature/infrastructure` 開發
2. Agent B 在 `feature/business-logic` 開發
3. 每日結束時,兩個分支都合併到 `develop`
4. Week 結束時,`develop` 合併到 `main`

### 衝突解決原則

**原則 1: 基礎設施優先**
- 如果 Agent A 和 Agent B 都修改了同一個基礎設施檔案
- 優先使用 Agent A 的版本
- Agent B 需要調整業務邏輯以適應

**原則 2: 業務邏輯獨立**
- 業務邏輯檔案由 Agent B 決定
- Agent A 不應修改業務邏輯

**原則 3: 共同討論**
- 如果無法決定,兩個 Agent 共同討論
- 在每日同步會議中解決

### 衝突預防

**策略 1: 明確分界**
- Agent A 只修改 `packages/shared/`, `packages/services/src/notifications/`, `apps/queue-worker/src/utils/`
- Agent B 只修改 `packages/api/`, `apps/queue-worker/src/handlers/`, `apps/queue-worker/src/index.ts`

**策略 2: 介面優先**
- Agent A 先定義介面 (interface, type)
- Agent B 實作業務邏輯

**策略 3: Mock 驅動**
- Agent B 可以先用 Mock 開發
- 等 Agent A 完成後再替換真實實作

---

## 📊 進度追蹤

### 使用檢查清單

每個 Agent 的計畫都有詳細的檢查清單 (checkbox),請務必:
1. **每日更新:** 完成任務後立即 tick off
2. **每日同步:** 在結束同步會議中分享進度
3. **透明化:** 遇到阻塞立即通知對方

### 交付物追蹤

每個 Day 結束都有明確的交付物,例如:
- ✅ Queue 配置完成
- ✅ 錯誤處理系統完整
- ✅ API 修改完成

確保每個交付物都真正完成再 tick off。

---

## 🚨 常見問題處理

### Q1: Agent B 需要 Agent A 的功能,但 Agent A 還沒完成怎麼辦?

**解決方案:**
1. Agent B 先創建 Mock 介面
2. 使用 Mock 繼續開發業務邏輯
3. 等 Agent A 完成後再替換真實實作

**範例:**
```typescript
// Agent B 先創建 Mock
class MockQueue {
  async send(message: any) {
    console.log('Mock:', message);
  }
}

// 等 Agent A 完成後替換
// const queue = env.TRANSCRIPTION_QUEUE;
```

### Q2: 兩個 Agent 都修改了同一個檔案怎麼辦?

**解決方案:**
1. 檢查修改是否在不同部分 (可能可以自動合併)
2. 如果衝突,按照「衝突解決原則」處理
3. 如果無法決定,在每日同步會議中討論

### Q3: Agent A 的進度比 Agent B 快很多怎麼辦?

**解決方案:**
1. Agent A 可以協助 Agent B (code review, 測試)
2. Agent A 可以提前開始下一階段的研究工作
3. 在每日同步會議中重新分配任務

### Q4: 遇到技術問題阻塞怎麼辦?

**解決方案:**
1. 立即在 Slack 頻道通知對方
2. 如果問題影響對方,優先解決
3. 如果問題不影響對方,可以先跳過,稍後回來處理
4. 在每日同步會議中討論解決方案

---

## ✅ 成功指標

### 平行開發成功的標誌:

1. **無重大衝突:** 兩個分支可以順利合併,衝突少於 5 處/週
2. **高效溝通:** 每日同步會議準時,時間不超過預定時間
3. **進度同步:** 兩個 Agent 的進度差異不超過 1 天
4. **交付物質量:** 所有交付物都通過測試,無重大 Bug

### Week 1 結束檢查:

- [ ] Queue 架構正常運作
- [ ] 錯誤處理系統完整
- [ ] Slack 通知正常發送
- [ ] MEDDIC 分析整合完成
- [ ] E2E 測試通過
- [ ] 無重大代碼衝突

### Week 2 結束檢查:

- [ ] Turborepo 配置完成
- [ ] Types 全部提取
- [ ] Schemas 全部提取
- [ ] tRPC 評估完成
- [ ] 構建速度提升 > 30%
- [ ] 文檔完整

### Week 3 結束檢查:

- [ ] 單元測試覆蓋率 > 80%
- [ ] E2E 測試通過
- [ ] 性能測試達標
- [ ] 部署成功
- [ ] 監控正常運作

---

## 🎯 開始使用

1. **閱讀各自的計畫:**
   - Agent A 閱讀 `AGENT_A_INFRASTRUCTURE_PLAN.md`
   - Agent B 閱讀 `AGENT_B_BUSINESS_LOGIC_PLAN.md`

2. **創建分支:**
   ```bash
   git checkout -b feature/infrastructure  # Agent A
   git checkout -b feature/business-logic  # Agent B
   ```

3. **設定每日同步:**
   - 在日曆中建立重複會議
   - 9:00 AM, 3:00 PM, 6:00 PM

4. **開始第一天:**
   - Review Day 1 的任務
   - 在上午同步會議中對齊
   - 開始執行!

---

## 📞 溝通渠道

**即時溝通:**
- Slack 頻道: `#queue-architecture-dev`
- 緊急問題立即 @mention

**文檔協調:**
- 使用此 GitHub repo 記錄決策
- 每日更新檢查清單

**代碼 Review:**
- 互相 review 對方的 PR
- 至少一個 approve 才能合併

---

祝兩位 Agent 合作愉快,開發順利! 🚀
