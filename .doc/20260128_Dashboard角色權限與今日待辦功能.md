# Dashboard è§’è‰²æ¬Šé™èˆ‡ä»Šæ—¥å¾…è¾¦åŠŸèƒ½

**æ—¥æœŸ**: 2026-01-28
**é¡å‹**: åŠŸèƒ½é–‹ç™¼
**å½±éŸ¿ç¯„åœ**: Dashboard é¦–é  (`/`)

---

## åŠŸèƒ½æ¦‚è¿°

æœ¬æ¬¡æ›´æ–°ç‚º Dashboard é¦–é æ–°å¢å…©é …é‡è¦åŠŸèƒ½ï¼š

1. **è§’è‰²æ¬Šé™æ•¸æ“šç¯„åœ** - æ ¹æ“šç”¨æˆ¶è§’è‰²é¡¯ç¤ºä¸åŒç¯„åœçš„çµ±è¨ˆæ•¸æ“š
2. **ä»Šæ—¥å¾…è¾¦å€å¡Š** - åœ¨é¦–é ç›´æ¥é¡¯ç¤ºéœ€è¦è·Ÿé€²çš„å®¢æˆ¶

---

## åŠŸèƒ½ä¸€ï¼šè§’è‰²æ¬Šé™æ•¸æ“šç¯„åœ

### éœ€æ±‚èƒŒæ™¯

åŸæœ¬ Dashboard é¦–é çš„çµ±è¨ˆæ•¸æ“šï¼ˆæ©Ÿæœƒç¸½æ•¸ã€å°è©±ç¸½æ•¸ã€åˆ†æç¸½æ•¸ã€å¹³å‡ PDCM åˆ†æ•¸ï¼‰åªé¡¯ç¤ºç•¶å‰ç™»å…¥ç”¨æˆ¶**å€‹äºº**çš„æ•¸æ“šï¼Œä¸è«–ç”¨æˆ¶è§’è‰²ç‚ºä½•ã€‚é€™å°è‡´ Admin å’Œ Manager ç„¡æ³•åœ¨é¦–é çœ‹åˆ°å…¨å±€æˆ–åœ˜éšŠçš„çµ±è¨ˆæ¦‚æ³ã€‚

### è§£æ±ºæ–¹æ¡ˆ

æ ¹æ“šç”¨æˆ¶è§’è‰²å‹•æ…‹èª¿æ•´æŸ¥è©¢ç¯„åœï¼š

| è§’è‰² | æ•¸æ“šç¯„åœ | é¡¯ç¤ºæ¨™ç±¤ |
|------|---------|---------|
| **Admin** | å…¨éƒ¨æ©Ÿæœƒ | ã€Œå…¨éƒ¨ã€ |
| **Manager** (department=all) | å…¨éƒ¨æ©Ÿæœƒ | ã€Œå…¨éƒ¨ã€ |
| **Manager** (department=ichef) | iCHEF éƒ¨é–€æ©Ÿæœƒ | ã€ŒiCHEF åœ˜éšŠã€ |
| **Manager** (department=beauty) | Beauty éƒ¨é–€æ©Ÿæœƒ | ã€ŒBeauty åœ˜éšŠã€ |
| **Sales Rep** | å€‹äººæ©Ÿæœƒ | ã€Œå€‹äººã€ |

### å¯¦ä½œç´°ç¯€

#### å¾Œç«¯ä¿®æ”¹

**æª”æ¡ˆ**: `packages/api/src/routers/analytics.ts`

```typescript
// å–å¾—ç”¨æˆ¶è§’è‰²å’Œéƒ¨é–€
const userProfile = await db.query.userProfiles.findFirst({
  where: eq(userProfiles.userId, userId),
});

const role = userProfile?.role || "sales_rep";
const department = userProfile?.department;

// æ ¹æ“šè§’è‰²æ±ºå®šæŸ¥è©¢ç¯„åœ
let targetUserIds: string[] = [userId];
let scopeLabel = "personal";

if (role === "admin") {
  scopeLabel = "all";
  targetUserIds = []; // ç©ºé™£åˆ—è¡¨ç¤ºä¸éæ¿¾ userId
} else if (role === "manager" && department) {
  scopeLabel = `dept:${department}`;
  if (department === "all") {
    targetUserIds = [];
  } else {
    const teamProfiles = await db.query.userProfiles.findMany({
      where: eq(userProfiles.department, department),
    });
    targetUserIds = teamProfiles.map((p) => p.userId);
  }
}
```

#### å¿«å– Key èª¿æ•´

ç‚ºäº†é¿å…ä¸åŒè§’è‰²çš„æ•¸æ“šäº’ç›¸å½±éŸ¿ï¼Œèª¿æ•´äº†å¿«å– Key çš„å‘½åæ–¹å¼ï¼š

| è§’è‰² | å¿«å– Key |
|------|---------|
| Admin | `dashboard:all:all` |
| Manager (ichef) | `dashboard:dept:ichef:dept:ichef` |
| Sales Rep | `dashboard:personal:{userId}` |

#### å‰ç«¯ä¿®æ”¹

**æª”æ¡ˆ**: `apps/web/src/routes/index.tsx`

åœ¨æ¨™é¡Œæ—é¡¯ç¤º scope æ¨™ç±¤ï¼š

```tsx
<div className="flex items-center gap-3">
  <h1>åˆ†æå„€è¡¨æ¿</h1>
  {dashboard?.scope && (
    <span className="rounded-full bg-purple-600/20 px-3 py-1 text-purple-400">
      {dashboard.scope}
    </span>
  )}
</div>
```

---

## åŠŸèƒ½äºŒï¼šä»Šæ—¥å¾…è¾¦å€å¡Š

### éœ€æ±‚èƒŒæ™¯

Dashboard é¦–é æ‡‰è©²é¡¯ç¤ºæœ€é‡è¦çš„è³‡è¨Šï¼Œè€Œå¾…è¾¦äº‹é …æ˜¯æ¥­å‹™æ¯å¤©éœ€è¦é—œæ³¨çš„æ ¸å¿ƒå…§å®¹ã€‚åŸæœ¬éœ€è¦åˆ‡æ›åˆ° `/todos` é é¢æ‰èƒ½æŸ¥çœ‹å¾…è¾¦ï¼Œå¢åŠ äº†æ“ä½œæ­¥é©Ÿã€‚

### è§£æ±ºæ–¹æ¡ˆ

åœ¨ Dashboard é¦–é æ–°å¢ã€Œä»Šæ—¥å¾…è¾¦ã€å€å¡Šï¼Œç›´æ¥é¡¯ç¤ºéœ€è¦è·Ÿé€²çš„å®¢æˆ¶ã€‚

### UI è¨­è¨ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ ä»Šæ—¥å¾…è¾¦                                      â”‚
â”‚    éœ€è¦è·Ÿé€²çš„å®¢æˆ¶                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â° Follow up ç‹è€é—†                              â”‚
â”‚    å¥½æ»‹å‘³é¤å»³ â€¢ 1æœˆ28æ—¥                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âš ï¸ ç¢ºèªåˆç´„ç°½ç½²                                  â”‚
â”‚    ç¾å‘³å°åƒ â€¢ é€¾æœŸ 1æœˆ26æ—¥                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é‚„æœ‰ 3 é …å¾…è¾¦...                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åŠŸèƒ½ç‰¹è‰²

| åŠŸèƒ½ | èªªæ˜ |
|------|------|
| **é€¾æœŸæé†’** | éæœŸå¾…è¾¦é¡¯ç¤ºç´…è‰²è­¦ç¤ºåœ–æ¨™ âš ï¸ |
| **å¿«é€Ÿå°èˆª** | é»æ“Šå¯è·³è½‰åˆ° `/todos` é é¢ |
| **é™åˆ¶é¡¯ç¤º** | æœ€å¤šé¡¯ç¤º 5 é …ï¼Œè¶…éé¡¯ç¤ºã€Œé‚„æœ‰ N é …å¾…è¾¦...ã€ |
| **ç©ºç‹€æ…‹** | ç„¡å¾…è¾¦æ™‚é¡¯ç¤ºç¶ è‰²æ‰“å‹¾ã€Œå¤ªæ£’äº†ï¼ä»Šæ—¥æ²’æœ‰å¾…è¾¦äº‹é …ã€ |

### å¯¦ä½œç´°ç¯€

**æª”æ¡ˆ**: `apps/web/src/routes/index.tsx`

```tsx
// ä»Šæ—¥å¾…è¾¦ï¼ˆå«éæœŸï¼‰
const todosQuery = useQuery({
  queryKey: ["salesTodo", "todaysTodos", { includeOverdue: true }],
  queryFn: async () => {
    return await client.salesTodo.getTodaysTodos({ includeOverdue: true });
  },
});

// åˆ¤æ–·æ˜¯å¦é€¾æœŸ
const isOverdue = new Date(todo.dueDate) < new Date(new Date().setHours(0, 0, 0, 0));
```

---

## UI å„ªåŒ–ï¼šç§»é™¤é‡è¤‡å°èˆªæŒ‰éˆ•

### è®Šæ›´å…§å®¹

ç§»é™¤ Dashboard é¦–é ä¸Šèˆ‡å°èˆªæ¬„é‡è¤‡çš„æŒ‰éˆ•ï¼š

| ç§»é™¤é …ç›® | åŸå›  |
|---------|------|
| ã€Œæ©Ÿæœƒç®¡ç†ã€æŒ‰éˆ• | å°èˆªæ¬„å·²æœ‰ |
| ã€Œå°è©±è¨˜éŒ„ã€æŒ‰éˆ• | å°èˆªæ¬„å·²æœ‰ |
| ä»Šæ—¥å¾…è¾¦ã€ŒæŸ¥çœ‹å…¨éƒ¨ã€æŒ‰éˆ• | å°èˆªæ¬„å·²æœ‰ |
| æœ€è¿‘åˆ†æã€ŒæŸ¥çœ‹å…¨éƒ¨ã€æŒ‰éˆ• | å°èˆªæ¬„å·²æœ‰ |

### æ•ˆç›Š

- æ¸›å°‘è¦–è¦ºé›œè¨Š
- é é¢æ›´ç°¡æ½”
- ç”¨æˆ¶å¯é€éå°èˆªæ¬„å¿«é€Ÿåˆ‡æ›é é¢

---

## éƒ¨ç½²æ­¥é©Ÿ

```bash
# 1. éƒ¨ç½²å¾Œç«¯
cd apps/server
bunx wrangler deploy

# 2. éƒ¨ç½²å‰ç«¯
cd apps/web
bun run build
bunx wrangler pages deploy dist --project-name=sales-ai-web --branch=main
```

---

## é©—è­‰é …ç›®

| é …ç›® | é æœŸçµæœ | ç‹€æ…‹ |
|------|---------|------|
| Admin ç™»å…¥å¾Œçœ‹åˆ°ã€Œå…¨éƒ¨ã€æ¨™ç±¤ | é¡¯ç¤ºå…¨éƒ¨æ©Ÿæœƒçµ±è¨ˆ | âœ… |
| Manager ç™»å…¥å¾Œçœ‹åˆ°åœ˜éšŠæ¨™ç±¤ | é¡¯ç¤ºåŒéƒ¨é–€æ©Ÿæœƒçµ±è¨ˆ | âœ… |
| Sales Rep ç™»å…¥å¾Œçœ‹åˆ°ã€Œå€‹äººã€æ¨™ç±¤ | é¡¯ç¤ºå€‹äººæ©Ÿæœƒçµ±è¨ˆ | âœ… |
| ä»Šæ—¥å¾…è¾¦å€å¡Šæ­£å¸¸é¡¯ç¤º | é¡¯ç¤ºå¾…è¾¦åˆ—è¡¨ | âœ… |
| é€¾æœŸå¾…è¾¦é¡¯ç¤ºç´…è‰²è­¦ç¤º | éæœŸé …ç›®æœ‰ç´…è‰²åœ–æ¨™ | âœ… |
| ç„¡å¾…è¾¦æ™‚é¡¯ç¤ºç©ºç‹€æ…‹ | é¡¯ç¤ºã€Œå¤ªæ£’äº†ï¼ä»Šæ—¥æ²’æœ‰å¾…è¾¦äº‹é …ã€ | âœ… |

---

## ç›¸é—œæ–‡ä»¶

- `packages/api/src/routers/analytics.ts` - å¾Œç«¯ Dashboard API
- `apps/web/src/routes/index.tsx` - å‰ç«¯ Dashboard é é¢
